{"version":3,"file":"module.js","mappings":"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","sources":["webpack:///external amd \"@grafana/data\"","webpack:///external amd \"@grafana/runtime\"","webpack:///external amd \"@grafana/ui\"","webpack:///external amd \"lodash\"","webpack:///external amd \"react\"","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./DataSource.ts","webpack:///./components/form/FormField.tsx","webpack:///./components/form/LabeledSwitch.tsx","webpack:///./ConfigEditor.tsx","webpack:///./types.ts","webpack:///./components/InstallationSelector.tsx","webpack:///./components/FilterEntry.tsx","webpack:///./components/MetaEditor.tsx","webpack:///./components/TweakSettings.tsx","webpack:///./components/VariableSelector.tsx","webpack:///./VariableEditor.tsx","webpack:///./module.ts","webpack:///./QueryEditor.tsx","webpack:///./components/useBackoffCallback.tsx"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__305__;","module.exports = __WEBPACK_EXTERNAL_MODULE__545__;","module.exports = __WEBPACK_EXTERNAL_MODULE__388__;","module.exports = __WEBPACK_EXTERNAL_MODULE__980__;","module.exports = __WEBPACK_EXTERNAL_MODULE__650__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {DataQueryRequest, DataQueryResponse, DataSourceInstanceSettings, MetricFindValue} from '@grafana/data';\nimport {DataSourceWithBackend, getBackendSrv, getTemplateSrv} from '@grafana/runtime';\nimport {FunctionX, Installation, MyDataSourceOptions, MyQuery, MyVariableQuery} from './types';\nimport {Observable} from 'rxjs';\nimport {toNumber} from \"lodash\";\n\nexport class DataSource extends DataSourceWithBackend<MyQuery, MyDataSourceOptions> {\n    private settings: DataSourceInstanceSettings<MyDataSourceOptions>;\n\n    constructor(instanceSettings: DataSourceInstanceSettings<MyDataSourceOptions>) {\n        super(instanceSettings);\n        this.settings = instanceSettings;\n    }\n\n    fetchInstallations(): Promise<Installation[]> {\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/installationinfo`,\n            })\n            .then(result => result.data);\n    }\n\n    fetchFunctions(installationId: number, meta?: { [key: string]: string }): Promise<FunctionX[]> {\n        const q = meta ? Object.keys(meta).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(meta[key])}`).join('&') : '';\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/functionx/${installationId}?${q}`,\n            })\n            .then(result => result.data as FunctionX[]);\n    }\n\n    query(options: DataQueryRequest<MyQuery>): Observable<DataQueryResponse> {\n        const templateSrv = getTemplateSrv();\n        const targets = options.targets.map(value => {\n            return {\n                ...value, installationId: value.installationVariable ? toNumber(templateSrv.replace(value.installationVariable)) : value.installationId,\n                meta: value.meta.map(meta => {\n                    return {\n                        key: templateSrv.replace(meta.key),\n                        value: templateSrv.replace(meta.value),\n                    }\n                }, value)\n            }\n        });\n        return super.query({...options, targets});\n    }\n\n    findMetaQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        if (query.metaKey === '' || query.installationId === '0' || query.installationId === '') {\n            return Promise.resolve([]);\n        }\n        let id = toNumber(query.installationId);\n        if (typeof query.installationId === 'string' && query.installationId.includes('$')) {\n            const tmp = getTemplateSrv().replace(query.installationId);\n            id = toNumber(tmp);\n        }\n        if (isNaN(id)) {\n            return Promise.reject(`Invalid installation id: ${query.installationId} => ${id}`);\n        }\n        const filter = query.meta ? query.meta.reduce<{ [key: string]: string }>((acc, meta) => {\n            if (meta.key !== '' && meta.value !== '') {\n                acc[meta.key] = meta.value;\n            }\n            return acc;\n        }, {}) : {};\n\n        return this.fetchFunctions(id, filter).then(functions => {\n            return functions.reduce<MetricFindValue[]>((acc, func) => {\n                if (!acc.find(f => f.text === func.meta[query.metaKey]) && func.meta[query.metaKey]) {\n                    return [...acc, {text: func.meta[query.metaKey], value: func.meta[query.metaKey]}];\n                }\n                return acc;\n            }, []);\n        }).then(result => {\n            return result;\n        })\n    }\n\n    metricFindQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        const qt = query.queryMode ? query.queryMode : 'functionMeta';\n        switch (qt) {\n            case 'installation':\n                return this.fetchInstallations().then(installations => {\n                    return installations.reduce<MetricFindValue[]>((acc, installation) => {\n                        return [...acc, {text: installation.name, value: installation.id}];\n                    }, []);\n                });\n            case 'functionMeta':\n                return this.findMetaQuery(query, options);\n            default:\n                return this.findMetaQuery(query, options);\n\n        }\n    }\n}\n","import React, {FormEventHandler, ReactElement} from 'react';\nimport {InlineField, Input} from \"@grafana/ui\";\n\nexport interface FormFieldProps {\n    label: string;\n    placeholder: string;\n    value: string;\n    name: string;\n    onChange: FormEventHandler<HTMLInputElement>;\n    tooltip?: ReactElement;\n    labelWidth?: number | \"auto\";\n    width?: number;\n    type?: string;\n}\n\nexport const FormField = ({type, tooltip, label, placeholder, name, value, onChange, labelWidth = 'auto', width}: FormFieldProps) => {\n    return(\n        <InlineField label={label} labelWidth={labelWidth} tooltip={tooltip} grow={true}>\n            <Input type={type} name={name} placeholder={placeholder} value={value} onChange={onChange}  width={width}/>\n        </InlineField>\n    )\n}\n","import React, {FormEventHandler} from \"react\";\nimport {InlineField, InlineFieldRow, InlineSwitch} from \"@grafana/ui\";\n\nexport interface LabeledSwitchProps {\n    label: string;\n    name: string;\n    value: boolean;\n    labelWidth?: number | \"auto\";\n    onChange: FormEventHandler<HTMLInputElement>;\n}\n\nexport const LabeledSwitch = ({label, value, name, onChange, labelWidth = 'auto'}: LabeledSwitchProps) => {\n    return (\n        <InlineFieldRow>\n            <InlineField label={label} labelWidth={labelWidth} >\n                <InlineSwitch value={value} name={name} onChange={onChange}/>\n            </InlineField>\n        </InlineFieldRow>\n    )\n}\n","import React, {ChangeEvent, SyntheticEvent, useEffect} from 'react';\nimport {MyDataSourceOptions, MySecureJsonData} from './types';\nimport {DataSourcePluginOptionsEditorProps} from '@grafana/data';\nimport {Alert, HorizontalGroup, VerticalGroup} from '@grafana/ui';\nimport {FormField} from 'components/form/FormField'\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\n\ninterface ConfigEditorProps extends DataSourcePluginOptionsEditorProps<MyDataSourceOptions, MySecureJsonData> {\n}\n\nexport const ConfigEditor = ({onOptionsChange, options}: ConfigEditorProps) => {\n    const {jsonData, secureJsonData, secureJsonFields} = options;\n    const [migrated, setMigrated] = React.useState(false);\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    const onChangeSwitch = (event: SyntheticEvent<HTMLInputElement, Event>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.currentTarget.name]: event.currentTarget.checked\n            }\n        });\n    }\n\n    const onChangeSecretText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            secureJsonData: {\n                ...secureJsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    useEffect(() => {\n        if (options.jsonData.apiKey !== undefined && options.jsonData.apiKey !== '') {\n            setMigrated(true);\n            let newJsonData = {...jsonData};\n            delete newJsonData.apiKey;\n            onOptionsChange({\n                ...options,\n                secureJsonData: {...secureJsonData, apiKey: options.jsonData.apiKey},\n                jsonData: newJsonData\n            });\n        }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return (\n        <VerticalGroup spacing={\"none\"}>\n            <FormField label={\"URL\"}\n                       value={options.jsonData.url || ''}\n                       name={\"url\"}\n                       placeholder={\"https://lynx.iotopen.se\"}\n                       onChange={onChangeText}\n                       labelWidth={15}\n                       width={40}\n            />\n            <LabeledSwitch labelWidth={15} label={\"OAuth2 Passthru\"} name={\"oauthPassThru\"}\n                           value={options.jsonData.oauthPassThru || false} onChange={onChangeSwitch}/>\n            {!options.jsonData.oauthPassThru &&\n                <FormField label={\"API Key\"}\n                           labelWidth={15}\n                           name={\"apiKey\"}\n                           value={secureJsonData?.apiKey ?? ''}\n                           onChange={onChangeSecretText}\n                           placeholder={secureJsonFields.apiKey ? 'Configured' : 'Enter API Key'}\n                           width={70}\n                           type={\"password\"}\n                />\n            }\n            {migrated && !secureJsonFields.apiKey &&\n                <HorizontalGroup width={\"100%\"}>\n                    <Alert title={\"Secure the API Key\"} severity={\"error\"}>\n                        <VerticalGroup>\n                            <p>\n                                The API key has migrated to a secure location. <br/>\n                                Please press save to migrate the key to the secure store and get rid of this message.\n                            </p>\n                        </VerticalGroup>\n                    </Alert>\n                </HorizontalGroup>}\n        </VerticalGroup>\n    )\n}\n","import {DataQuery, DataSourceJsonData} from '@grafana/data';\n\n\nexport interface MetaEntry {\n    key: string;\n    value: string;\n}\n\nexport interface MyVariableQuery {\n    queryMode: string;\n    installationId: string | number;\n    meta: MetaEntry[];\n    metaKey: string;\n}\n\nexport interface MyQuery extends DataQuery {\n    installationId: number;\n    installationVariable?: string;\n    type: string;\n    meta: MetaEntry[];\n    tabledata: boolean;\n    stateOnly: boolean;\n    metaAsFields: boolean;\n    joinDeviceMeta: boolean;\n    linkKey: string;\n    messageFrom: string;\n    groupBy: string;\n    nameBy: string;\n}\n\n\nexport const defaultQuery: Partial<MyQuery> = {\n    installationId: 0,\n    type: '',\n    meta: [{key: 'type', value: ''}],\n};\n\nexport interface FunctionX {\n    id: number;\n    type: string;\n    meta: { [index: string]: string };\n}\n\nexport interface DeviceX {\n    id: number;\n    type: string;\n    meta: { [index: string]: string };\n}\n\nexport interface Installation {\n    id: number;\n    client_id: number;\n    name: string;\n}\n\n/**\n * These are options configured for each DataSource instance\n */\nexport interface MyDataSourceOptions extends DataSourceJsonData {\n    url?: string;\n    apiKey?: string;\n    oauthPassThru?: boolean;\n    auth?: string;\n}\n\nexport interface MySecureJsonData {\n    apiKey?: string;\n}\n","import {Installation} from \"../types\";\nimport {Select} from \"@grafana/ui\";\nimport React, {useCallback, useMemo} from \"react\";\nimport {SelectableValue} from \"@grafana/data\";\nimport {SelectValue} from \"@grafana/ui/components/Select/types\";\n\n\nexport interface InstallationSelectorProps {\n    isLoading: boolean;\n    installations: Installation[];\n    installation: Installation;\n    onSelection(installation: Installation): void;\n}\n\nexport const InstallationSelector = ({\n                                         isLoading,\n                                         installations,\n                                         installation,\n                                         onSelection\n                                     }: InstallationSelectorProps) => {\n    const installationOptions = useMemo<Array<SelectValue<Installation>>>(() => {\n        return installations.map((installation) => {\n            return {label: installation.name, value: installation};\n        });\n    }, [installations]);\n\n    const currentSelectedInstallation = useMemo<SelectValue<Installation>>(() => {\n        return {label: installation.name, value: installation};\n    }, [installation]);\n\n    const onChange = (event: SelectableValue<Installation>) => {\n        onSelection(event.value ?? installations[0]);\n    }\n\n    const filter = useCallback((option: SelectableValue<Installation>, rawInput: string) => {\n        const input = rawInput.toLowerCase();\n        return option.value?.name?.toLowerCase().includes(input) ?? false;\n    }, []);\n\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                isLoading={isLoading}\n                placeholder={\"Installation\"}\n                noOptionsMessage={\"No available installations\"}\n                filterOption={filter}\n                width={65}\n                options={installationOptions}\n                menuPlacement={'bottom'}\n                onChange={onChange}\n                value={currentSelectedInstallation}\n            />\n        </div>\n    )\n};\n","import React, {MouseEventHandler, useCallback, useMemo} from 'react';\nimport {Button, Select} from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport {MetaEntry} from \"../types\";\n\ntype onDeleteFunction = () => void;\ntype onUpdateFunction = (event: MetaEntry) => void;\n\ninterface FilterEntryProps {\n  data: MetaEntry;\n  onDelete: onDeleteFunction;\n  onUpdate: onUpdateFunction;\n  keys?: string[];\n  values?: string[];\n}\n\n\nexport const FilterEntry = ({data, keys, values, onUpdate, onDelete}: FilterEntryProps) => {\n  const selectableKeys = useMemo<SelectableValue[]>(() => {\n    if (keys) {\n      return keys.map((value) => ({label: value, value: value}))\n    }\n    return []\n  }, [keys]);\n  const selectableValues = useMemo<SelectableValue[]>(() => {\n    if (values) {\n      return values.map((value) => ({label: value, value: value}))\n    }\n    return []\n  }, [values]);\n\n  const currentKey = useMemo<SelectableValue>(() => {\n    return {label: data.key, value: data.key}\n  }, [data]);\n\n  const currentValue = useMemo<SelectableValue>(() => {\n    return {label: data.value, value: data.value}\n  }, [data]);\n\n  const onChangeKey = useCallback((event: SelectableValue) => {\n    onUpdate({...data, key: event.value});\n  }, [data, onUpdate]);\n\n  const onChangeValue = useCallback((event: SelectableValue) => {\n    onUpdate({...data, value: event.value});\n  }, [data, onUpdate]);\n\n  const onCreateKey = useCallback((newValue: string) => {\n    onUpdate({...data, key: newValue})\n  }, [data, onUpdate]);\n\n  const onCreateValue = useCallback((newValue: string) => {\n    onUpdate({...data, value: newValue})\n  }, [data, onUpdate]);\n\n  const deleteEventHandler = useCallback<MouseEventHandler<HTMLButtonElement>>((event) => {\n    event.preventDefault();\n    onDelete();\n  }, [onDelete]);\n\n  return (\n      <div className={'gf-form-inline'}>\n        <div className={'gf-form'}>\n          <span className={'gf-form-label query-keyword'}>key</span>\n          <Select\n              width={30}\n              options={selectableKeys}\n              onChange={onChangeKey}\n              onCreateOption={onCreateKey}\n              value={currentKey}\n              isSearchable={true}\n              allowCustomValue={true}\n              menuPlacement={'bottom'}\n              placeholder={'meta key'}\n          />\n          <span className={'gf-form-label query-keyword'}>match</span>\n          <Select\n              width={30}\n              options={selectableValues}\n              onChange={onChangeValue}\n              onCreateOption={onCreateValue}\n              value={currentValue}\n              isSearchable={true}\n              allowCustomValue={true}\n              menuPlacement={'bottom'}\n              placeholder={'wildcard match'}\n          />\n          <Button variant={'destructive'} onClick={deleteEventHandler} icon={'trash-alt'} />\n        </div>\n      </div>\n  )\n};\n","import {MetaEntry} from \"../types\";\nimport {FilterEntry} from \"./FilterEntry\";\nimport React, {MouseEvent, useCallback} from \"react\";\nimport {Button, VerticalGroup} from \"@grafana/ui\";\n\n\nexport interface MetaEditorProps {\n    entries: MetaEntry[];\n    onUpdate(entries: MetaEntry[]): void;\n    hints?: {[key: string]: string[]};\n}\n\nexport const MetaEditor = ({entries: ents, onUpdate, hints}: MetaEditorProps) => {\n\n    const onMetaDelete = useCallback((idx: number) => {\n        const tmp = ents.filter((value, index) => index !== idx);\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    const onMetaAdd = useCallback((e: MouseEvent) => {\n        onUpdate([...ents, {key: '', value: ''}]);\n        e.preventDefault();\n    }, [ents, onUpdate]);\n\n    const onMetaUpdate = useCallback((idx: number, value: MetaEntry) => {\n        const tmp = ents.map((entry, index) => {\n            if (index === idx) {\n                return value;\n            }\n            return entry;\n        });\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    return (\n        <VerticalGroup>\n            <div className={'gf-form-inline,ui-list'}>\n                {ents.map((value, idx) => {\n                    return (\n                        <FilterEntry\n                            key={idx}\n                            data={value}\n                            onDelete={() => {onMetaDelete(idx)}}\n                            onUpdate={(value) => onMetaUpdate(idx, value)}\n                            keys={hints ? Object.keys(hints):[]}\n                            values={hints ? hints[value.key] ?? []:[]}\n                        />\n                    );\n                })}\n            </div>\n            <div className={'gf-form-inline'} style={{paddingBottom: 10}}>\n                <Button onClick={onMetaAdd} icon={'plus'}>Add filter</Button>\n            </div>\n        </VerticalGroup>\n    )\n};\n","import {MyQuery} from \"../types\";\nimport {\n    VerticalGroup,\n    HorizontalGroup,\n} from \"@grafana/ui\";\nimport React, {FormEvent} from \"react\";\nimport {LabeledSwitch} from \"./form/LabeledSwitch\";\nimport {FormField} from \"./form/FormField\";\n\nexport interface TweakSettingsProps {\n    query: MyQuery;\n\n    onChange(query: MyQuery): void;\n\n    onRunQuery(): void;\n}\n\nconst tooltipGroupBy = (\n    <>\n        Group series by some meta key or payload <code>msg</code> field. Defaults to Function ID.\n    </>\n);\nconst tooltipNameBy = (\n    <>\n        This will name series based on some meta key.\n        <br/>\n        Defaults to <code>name</code>.\n    </>\n);\nconst tooltipMessageFrom = (\n    <>\n        Using this field will join matching functions with the same filter, but the type changed to this field. The\n        msg\n        field will be overwritten by messages matching this type, linked through <code>device_id</code> meta key.\n        Useful\n        for eg. joining positional data. <br/>\n        This field is only applied on table data.\n    </>\n);\n\nexport const TweakSettings = ({query, onChange, onRunQuery}: TweakSettingsProps) => {\n\n    const onGroupByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, groupBy: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onNameByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, nameBy: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onMessageChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, messageFrom: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onLinkChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, linkKey: event.currentTarget.value});\n        onRunQuery();\n    }\n    const onSwitchChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, [event.currentTarget.name]: event.currentTarget.checked});\n        onRunQuery();\n    }\n\n    return (\n        <>\n            <VerticalGroup spacing={\"xs\"}>\n                <FormField\n                    name={'groupBy'}\n                    labelWidth={15}\n                    label={'Group by'}\n                    onChange={onGroupByChange}\n                    value={query.groupBy}\n                    placeholder={'Function ID'}\n                    tooltip={tooltipGroupBy}\n                />\n                <FormField\n                    name={'nameBy'}\n                    labelWidth={15}\n                    label={'Name by'}\n                    placeholder={'name'}\n                    onChange={onNameByChange}\n                    value={query.nameBy}\n                    tooltip={tooltipNameBy}\n                />\n                <HorizontalGroup align={\"flex-start\"} spacing={\"xs\"}>\n                    <LabeledSwitch label={\"As table data\"} value={query.tabledata} name={\"tabledata\"}\n                                   onChange={onSwitchChange} labelWidth={15}/>\n                    {query.tabledata && <VerticalGroup spacing={\"xs\"} align={\"flex-start\"}>\n                        <FormField\n                            placeholder={'eg. latitude'}\n                            name={'messageFrom'}\n                            labelWidth={20}\n                            label={'Message from'}\n                            onChange={onMessageChange}\n                            value={query.messageFrom}\n                            tooltip={tooltipMessageFrom}\n                        />\n                        <FormField labelWidth={20} placeholder={'device_id'} name={'linkKey'} label={'Linked with'} onChange={onLinkChange}\n                                   value={query.linkKey}/>\n                        <LabeledSwitch label={\"Meta as fields\"} labelWidth={20} value={query.metaAsFields} name={\"metaAsFields\"}\n                                       onChange={onSwitchChange}/>\n                        {query.metaAsFields && <LabeledSwitch label={\"Add device meta\"} labelWidth={20} name={\"joinDeviceMeta\"}\n                                                              value={query.joinDeviceMeta} onChange={onSwitchChange}/>}\n                    </VerticalGroup>\n                    }\n                </HorizontalGroup>\n                <LabeledSwitch label={\"Current state only\"} value={query.stateOnly} name={\"stateOnly\"}\n                               onChange={onSwitchChange}/>\n            </VerticalGroup>\n        </>\n    )\n}\n","import {getTemplateSrv} from \"@grafana/runtime\";\nimport {Select} from \"@grafana/ui\";\nimport React from \"react\";\n\n\ntype VariableSelectorProps = {\n    value: string;\n    onSelection: (selection: string) => void;\n}\n\nexport const VariableSelector = ({value, onSelection}: VariableSelectorProps) => {\n    const templateSrv = getTemplateSrv();\n    const variables = templateSrv.getVariables();\n    const options = variables.map((variable) => {\n        return {label: variable.name, value: `$\\{${variable.name}}`};\n    });\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                placeholder={\"Variable\"}\n                noOptionsMessage={\"No available variables\"}\n                width={65}\n                options={options}\n                menuPlacement={'bottom'}\n                onChange={(event) => onSelection(event.value ?? '')}\n                value={value}\n            />\n        </div>\n    )\n}\n","import React, {ChangeEvent, useMemo} from \"react\";\nimport {MetaEntry, MyVariableQuery} from \"./types\";\nimport {\n    HorizontalGroup,\n    InlineField,\n    InlineFieldRow,\n    RadioButtonGroup,\n    VerticalGroup\n} from \"@grafana/ui\";\nimport {FormField} from \"./components/form/FormField\";\nimport {MetaEditor} from \"./components/MetaEditor\";\n\nexport interface MyVariableEditorProps {\n    query: MyVariableQuery;\n    onChange: (query: MyVariableQuery) => void;\n}\n\nexport const VariableEditor = ({query, onChange}: MyVariableEditorProps) => {\n\n    const q = useMemo(() => {\n        if (query.queryMode === undefined || query.queryMode === '') {\n            return {...query, queryMode: 'meta', installationId: '0', meta: [], metaKey: ''};\n        }\n        return query;\n    }, [query]);\n\n    const updateMeta = (meta: MetaEntry[]) => {\n        onChange({...q, meta: meta});\n    }\n\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onChange({...q, [event.target.name]: event.target.value});\n    }\n\n    const queryModeOptions = [\n        {label: 'Meta values', value: 'meta'},\n        {label: 'Installations', value: 'installation'},\n    ];\n\n    return (\n        <VerticalGroup spacing={\"xs\"}>\n            <HorizontalGroup spacing={\"xs\"}>\n                <InlineFieldRow>\n                    <InlineField label={\"Query mode\"} labelWidth={15}>\n                        <RadioButtonGroup options={queryModeOptions} value={q.queryMode} onChange={(v) => {\n                            onChange({...q, queryMode: v ?? 'meta'});\n                        }}/>\n                    </InlineField>\n                </InlineFieldRow>\n            </HorizontalGroup>\n            {q.queryMode === 'meta' &&\n                <VerticalGroup>\n                    <HorizontalGroup>\n                        <FormField label={\"Installation ID\"} placeholder={\"ID\"}\n                                   value={q.installationId === undefined ? '0' : q.installationId.toString()}\n                                   name={\"installationId\"}\n                                   onChange={onChangeText} labelWidth={15}/>\n                        <FormField label={\"Meta key\"} placeholder={\"name\"} labelWidth={15} value={query.metaKey ?? ''}\n                                   name={\"metaKey\"}\n                                   onChange={onChangeText}/>\n                    </HorizontalGroup>\n                    <MetaEditor entries={q.meta ?? []} onUpdate={updateMeta}/>\n                </VerticalGroup>\n            }\n        </VerticalGroup>\n    )\n}\n","import { DataSource } from './DataSource';\nimport { ConfigEditor } from './ConfigEditor';\nimport { QueryEditor } from './QueryEditor';\nimport { MyQuery, MyDataSourceOptions } from './types';\nimport { DataSourcePlugin } from '@grafana/data';\nimport {VariableEditor} from \"./VariableEditor\";\n\nexport const plugin = new DataSourcePlugin<DataSource, MyQuery, MyDataSourceOptions>(DataSource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditor(QueryEditor)\n  .setVariableQueryEditor(VariableEditor);\n","import React, {useState, useEffect, useMemo, useCallback} from 'react';\nimport {DataSource} from './DataSource';\nimport {MyQuery, MyDataSourceOptions, Installation, FunctionX, MetaEntry, defaultQuery} from './types';\nimport {QueryEditorProps} from '@grafana/data';\nimport {InstallationSelector} from \"./components/InstallationSelector\";\nimport {MetaEditor} from \"./components/MetaEditor\";\nimport {TweakSettings} from \"./components/TweakSettings\";\nimport {useBackoffCallback} from \"./components/useBackoffCallback\";\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\nimport {InlineFieldRow} from \"@grafana/ui\";\nimport {VariableSelector} from \"./components/VariableSelector\";\n\ntype Props = QueryEditorProps<DataSource, MyQuery, MyDataSourceOptions>;\n\nexport const QueryEditor = ({onChange, query, onRunQuery, datasource}: Props) => {\n    const [installations, setInstallations] = useState<Installation[]>([])\n    const [loadingInstallations, setLoadingInstallations] = useState<boolean>(true)\n\n    const squery = useMemo(() => {\n        let q = query;\n        if (q.installationId === undefined) {\n            q = {...q, ...defaultQuery};\n            onChange(q);\n        }\n        return q;\n    }, [query, onChange])\n\n    const [functions, setFunctions] = useState<FunctionX[]>([])\n    const [loadingFunctions, setLoadingFunctions] = useState<boolean>(false)\n\n    const [selectedInstallation, setSelectedInstallation] = useState<Installation>({id: 0, name: '', client_id: 0})\n\n    const onRunQueryTimed = useBackoffCallback(onRunQuery, 250);\n\n    useEffect(() => {\n        datasource.fetchInstallations().then(installations => {\n            let tmpInstallation: Installation | undefined = installations.find(i => i.id === query.installationId);\n            if (tmpInstallation === undefined && installations.length === 0) {\n                tmpInstallation = {id: 0, name: 'No installations available', client_id: 0};\n            }\n            if (tmpInstallation === undefined && installations.length > 0) {\n                tmpInstallation = installations[0];\n            }\n            setSelectedInstallation(tmpInstallation!);\n            setInstallations(installations);\n        }).finally(() => {\n            setLoadingInstallations(false)\n        });\n    }, []); // eslint-disable-line\n\n    useEffect(() => {\n        if (selectedInstallation.id === 0) {\n            return\n        }\n        setLoadingFunctions(true);\n        datasource.fetchFunctions(Number(selectedInstallation.id)).then(functions => {\n            setFunctions(functions);\n            onRunQueryTimed();\n        }).finally(() => {\n            setLoadingFunctions(false)\n        });\n    }, [setLoadingFunctions, selectedInstallation, setFunctions, datasource, onRunQueryTimed]);\n\n    const onUpdateMeta = useCallback((entries: MetaEntry[]) => {\n        onChange({...squery, meta: entries});\n        onRunQueryTimed();\n    }, [onChange, squery, onRunQueryTimed]);\n\n    useEffect(() => {\n        if (selectedInstallation.id !== 0 &&\n            selectedInstallation.id !== squery.installationId) {\n            onChange({...squery, installationId: selectedInstallation.id});\n        }\n    }, [selectedInstallation, squery, onChange])\n\n    const hints = useMemo(() => {\n        const res: { [key: string]: string[] } = {};\n        for (const func of functions) {\n            if (res[\"type\"] === undefined) {\n                res[\"type\"] = [func.type];\n            } else {\n                if (res[\"type\"].indexOf(func.type) === -1) {\n                    res[\"type\"].push(func.type);\n                }\n            }\n            for (const metaKey in func.meta) {\n                if (res[metaKey] === undefined) {\n                    res[metaKey] = [];\n                }\n                if (res[metaKey].indexOf(func.meta[metaKey]) === -1) {\n                    res[metaKey].push(func.meta[metaKey]);\n                }\n            }\n        }\n        return res;\n    }, [functions]);\n\n    const setInstallationVariable = (variable?: string) => {\n        onChange({...squery, installationVariable: variable});\n    };\n\n    return (\n        <div className={'section gf-form-group'}>\n            <InlineFieldRow>\n                {squery.installationVariable === undefined ?\n                    <InstallationSelector isLoading={loadingInstallations || loadingFunctions}\n                                          installations={installations}\n                                          installation={selectedInstallation}\n                                          onSelection={setSelectedInstallation}/> :\n                    <VariableSelector value={squery.installationVariable} onSelection={setInstallationVariable}/>}\n                <LabeledSwitch label={\"From variable\"} name={\"useVariable\"}\n                               value={squery.installationVariable !== undefined} onChange={(e) => {\n                    if (e.currentTarget.checked) {\n                        setInstallationVariable('');\n                    } else {\n                        setInstallationVariable(undefined);\n                    }\n                }}/>\n            </InlineFieldRow>\n            <MetaEditor entries={squery.meta || []}\n                        onUpdate={onUpdateMeta}\n                        hints={hints}\n            />\n            <TweakSettings query={query} onChange={onChange} onRunQuery={onRunQueryTimed}/>\n        </div>\n    )\n};\n","import {useCallback, useRef} from \"react\";\nexport const useBackoffCallback = (fn: () => void, delay: number) => {\n    const ticker = useRef<number>();\n    return useCallback(() => {\n        if (ticker.current !== undefined) {\n            window.clearTimeout(ticker.current);\n        }\n        ticker.current = window.setTimeout(fn, delay);\n    }, [fn, delay]);\n}\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__305__","__WEBPACK_EXTERNAL_MODULE__545__","__WEBPACK_EXTERNAL_MODULE__388__","__WEBPACK_EXTERNAL_MODULE__980__","__WEBPACK_EXTERNAL_MODULE__650__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","DataSource","DataSourceWithBackend","fetchInstallations","getBackendSrv","datasourceRequest","method","url","this","settings","then","result","data","fetchFunctions","installationId","meta","q","keys","map","encodeURIComponent","join","query","options","templateSrv","getTemplateSrv","targets","installationVariable","toNumber","replace","super","findMetaQuery","metaKey","Promise","resolve","id","includes","tmp","isNaN","reject","filter","reduce","acc","functions","func","find","f","text","metricFindQuery","queryMode","installations","installation","name","constructor","instanceSettings","FormField","type","tooltip","label","placeholder","onChange","labelWidth","width","InlineField","grow","Input","LabeledSwitch","InlineFieldRow","InlineSwitch","defaultQuery","InstallationSelector","isLoading","onSelection","installationOptions","useMemo","currentSelectedInstallation","useCallback","option","rawInput","input","toLowerCase","div","className","Select","noOptionsMessage","filterOption","menuPlacement","event","FilterEntry","values","onUpdate","onDelete","selectableKeys","selectableValues","currentKey","currentValue","onChangeKey","onChangeValue","onCreateKey","newValue","onCreateValue","deleteEventHandler","preventDefault","span","onCreateOption","isSearchable","allowCustomValue","Button","variant","onClick","icon","MetaEditor","entries","ents","hints","onMetaDelete","idx","index","onMetaAdd","e","onMetaUpdate","entry","VerticalGroup","style","paddingBottom","tooltipGroupBy","code","tooltipNameBy","br","tooltipMessageFrom","TweakSettings","onRunQuery","onSwitchChange","currentTarget","checked","spacing","groupBy","nameBy","HorizontalGroup","align","tabledata","messageFrom","linkKey","metaAsFields","joinDeviceMeta","stateOnly","VariableSelector","getVariables","variable","plugin","DataSourcePlugin","setConfigEditor","onOptionsChange","secureJsonData","jsonData","secureJsonFields","migrated","setMigrated","React","useEffect","apiKey","newJsonData","target","oauthPassThru","Alert","title","severity","p","setQueryEditor","datasource","setInstallations","useState","loadingInstallations","setLoadingInstallations","squery","setFunctions","loadingFunctions","setLoadingFunctions","selectedInstallation","setSelectedInstallation","client_id","onRunQueryTimed","fn","delay","ticker","useRef","current","window","clearTimeout","setTimeout","useBackoffCallback","tmpInstallation","i","length","finally","Number","onUpdateMeta","res","indexOf","push","setInstallationVariable","setVariableQueryEditor","onChangeText","RadioButtonGroup","v","toString"],"sourceRoot":""}