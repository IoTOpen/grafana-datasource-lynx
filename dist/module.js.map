{"version":3,"file":"module.js","mappings":"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","sources":["webpack:///external amd \"@grafana/data\"","webpack:///external amd \"@grafana/runtime\"","webpack:///external amd \"@grafana/ui\"","webpack:///external amd \"lodash\"","webpack:///external amd \"react\"","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./DataSource.ts","webpack:///./components/form/FormField.tsx","webpack:///./components/form/LabeledSwitch.tsx","webpack:///./ConfigEditor.tsx","webpack:///./types.ts","webpack:///./components/InstallationSelector.tsx","webpack:///./components/FilterEntry.tsx","webpack:///./components/MetaEditor.tsx","webpack:///./components/TweakSettings.tsx","webpack:///./components/VariableSelector.tsx","webpack:///./VariableEditor.tsx","webpack:///./module.ts","webpack:///./QueryEditor.tsx","webpack:///./components/useBackoffCallback.tsx"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__305__;","module.exports = __WEBPACK_EXTERNAL_MODULE__545__;","module.exports = __WEBPACK_EXTERNAL_MODULE__388__;","module.exports = __WEBPACK_EXTERNAL_MODULE__980__;","module.exports = __WEBPACK_EXTERNAL_MODULE__650__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {DataQueryRequest, DataQueryResponse, DataSourceInstanceSettings, MetricFindValue} from '@grafana/data';\nimport {DataSourceWithBackend, getBackendSrv, getTemplateSrv} from '@grafana/runtime';\nimport {FunctionX, Installation, MyDataSourceOptions, MyQuery, MyVariableQuery} from './types';\nimport {Observable} from 'rxjs';\nimport {toNumber} from \"lodash\";\n\nexport class DataSource extends DataSourceWithBackend<MyQuery, MyDataSourceOptions> {\n    private settings: DataSourceInstanceSettings<MyDataSourceOptions>;\n\n    constructor(instanceSettings: DataSourceInstanceSettings<MyDataSourceOptions>) {\n        super(instanceSettings);\n        this.settings = instanceSettings;\n    }\n\n    fetchInstallations(): Promise<Installation[]> {\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/installationinfo`,\n            })\n            .then(result => result.data);\n    }\n\n    fetchFunctions(installationId: number, meta?: { [key: string]: string }): Promise<FunctionX[]> {\n        const q = meta ? Object.keys(meta).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(meta[key])}`).join('&') : '';\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/functionx/${installationId}?${q}`,\n            })\n            .then(result => result.data as FunctionX[]);\n    }\n\n    query(options: DataQueryRequest<MyQuery>): Observable<DataQueryResponse> {\n        console.log('query', options);\n        const templateSrv = getTemplateSrv();\n        //const varMap = templateSrv.getVariables().reduce((acc, x) => {\n        //    acc[x.name] = templateSrv.replace(`\\${${x.name}}`);\n        //    return acc\n        //}, {} as { [key: string]: string});\n        const targets = options.targets.map(value => {\n            return {\n                //...value, installationId: value.installationVariable ? toNumber(varMap[value.installationVariable]) : value.installationId,\n                ...value, installationId: value.installationVariable ? toNumber(templateSrv.replace(value.installationVariable)) : value.installationId,\n                meta: value.meta.map(meta => {\n                    return {\n                        key: templateSrv.replace(meta.key),\n                        value: templateSrv.replace(meta.value),\n                    }\n                }, value)\n            }\n        });\n        return super.query({...options, targets});\n    }\n\n    findMetaQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        if (query.metaKey === '' || query.installationId === 0) {\n            return Promise.resolve([]);\n        }\n        const filter = query.meta ? query.meta.reduce<{ [key: string]: string }>((acc, meta) => {\n            if (meta.key !== '' && meta.value !== '') {\n                acc[meta.key] = meta.value;\n            }\n            return acc;\n        }, {}) : {};\n\n        return this.fetchFunctions(query.installationId, filter).then(functions => {\n            return functions.reduce<MetricFindValue[]>((acc, func) => {\n                if (!acc.find(f => f.text === func.meta[query.metaKey]) && func.meta[query.metaKey]) {\n                    return [...acc, {text: func.meta[query.metaKey], value: func.meta[query.metaKey]}];\n                }\n                return acc;\n            }, []);\n        }).then(result => {\n            return result;\n        })\n    }\n\n    metricFindQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        const qt = query.queryMode ? query.queryMode : 'functionMeta';\n        switch (qt) {\n            case 'installation':\n                return this.fetchInstallations().then(installations => {\n                    return installations.reduce<MetricFindValue[]>((acc, installation) => {\n                        return [...acc, {text: installation.name, value: installation.id}];\n                    }, []);\n                });\n            case 'functionMeta':\n                return this.findMetaQuery(query, options);\n            default:\n                return this.findMetaQuery(query, options);\n\n        }\n    }\n}\n","import React, {FormEventHandler, ReactElement} from 'react';\nimport {InlineField, Input} from \"@grafana/ui\";\n\nexport interface FormFieldProps {\n    label: string;\n    placeholder: string;\n    value: string;\n    name: string;\n    onChange: FormEventHandler<HTMLInputElement>;\n    tooltip?: ReactElement;\n    labelWidth?: number | \"auto\";\n    width?: number;\n    type?: string;\n}\n\nexport const FormField = ({type, tooltip, label, placeholder, name, value, onChange, labelWidth = 'auto', width}: FormFieldProps) => {\n    return(\n        <InlineField label={label} labelWidth={labelWidth} tooltip={tooltip} grow={true}>\n            <Input type={type} name={name} placeholder={placeholder} value={value} onChange={onChange}  width={width}/>\n        </InlineField>\n    )\n}\n","import React, {FormEventHandler} from \"react\";\nimport {InlineField, InlineFieldRow, InlineSwitch} from \"@grafana/ui\";\n\nexport interface LabeledSwitchProps {\n    label: string;\n    name: string;\n    value: boolean;\n    labelWidth?: number | \"auto\";\n    onChange: FormEventHandler<HTMLInputElement>;\n}\n\nexport const LabeledSwitch = ({label, value, name, onChange, labelWidth = 'auto'}: LabeledSwitchProps) => {\n    return (\n        <InlineFieldRow>\n            <InlineField label={label} labelWidth={labelWidth} >\n                <InlineSwitch value={value} name={name} onChange={onChange}/>\n            </InlineField>\n        </InlineFieldRow>\n    )\n}\n","import React, {ChangeEvent, SyntheticEvent, useEffect} from 'react';\nimport {MyDataSourceOptions, MySecureJsonData} from './types';\nimport {DataSourcePluginOptionsEditorProps} from '@grafana/data';\nimport {Alert, HorizontalGroup, VerticalGroup} from '@grafana/ui';\nimport {FormField} from 'components/form/FormField'\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\n\ninterface ConfigEditorProps extends DataSourcePluginOptionsEditorProps<MyDataSourceOptions, MySecureJsonData> {\n}\n\nexport const ConfigEditor = ({onOptionsChange, options}: ConfigEditorProps) => {\n    const {jsonData, secureJsonData, secureJsonFields} = options;\n    const [migrated, setMigrated] = React.useState(false);\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    const onChangeSwitch = (event: SyntheticEvent<HTMLInputElement, Event>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.currentTarget.name]: event.currentTarget.checked\n            }\n        });\n    }\n\n    const onChangeSecretText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            secureJsonData: {\n                ...secureJsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    useEffect(() => {\n        if (options.jsonData.apiKey !== undefined && options.jsonData.apiKey !== '') {\n            setMigrated(true);\n            let newJsonData = {...jsonData};\n            delete newJsonData.apiKey;\n            onOptionsChange({\n                ...options,\n                secureJsonData: {...secureJsonData, apiKey: options.jsonData.apiKey},\n                jsonData: newJsonData\n            });\n        }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return (\n        <VerticalGroup spacing={\"none\"}>\n            <FormField label={\"URL\"}\n                       value={options.jsonData.url || ''}\n                       name={\"url\"}\n                       placeholder={\"https://lynx.iotopen.se\"}\n                       onChange={onChangeText}\n                       labelWidth={15}\n                       width={40}\n            />\n            <LabeledSwitch labelWidth={15} label={\"OAuth2 Passthru\"} name={\"oauthPassThru\"}\n                           value={options.jsonData.oauthPassThru || false} onChange={onChangeSwitch}/>\n            {!options.jsonData.oauthPassThru &&\n                <FormField label={\"API Key\"}\n                           labelWidth={15}\n                           name={\"apiKey\"}\n                           value={secureJsonData?.apiKey ?? ''}\n                           onChange={onChangeSecretText}\n                           placeholder={secureJsonFields.apiKey ? 'Configured' : 'Enter API Key'}\n                           width={70}\n                           type={\"password\"}\n                />\n            }\n            {migrated && !secureJsonFields.apiKey &&\n                <HorizontalGroup width={\"100%\"}>\n                    <Alert title={\"Secure the API Key\"} severity={\"error\"}>\n                        <VerticalGroup>\n                            <p>\n                                The API key has migrated to a secure location. <br/>\n                                Please press save to migrate the key to the secure store and get rid of this message.\n                            </p>\n                        </VerticalGroup>\n                    </Alert>\n                </HorizontalGroup>}\n        </VerticalGroup>\n    )\n}\n","import {DataQuery, DataSourceJsonData} from '@grafana/data';\n\n\nexport interface MetaEntry {\n    key: string;\n    value: string;\n}\n\nexport interface MyVariableQuery {\n    queryMode: string;\n    installationId: number;\n    meta: MetaEntry[];\n    metaKey: string;\n}\n\nexport interface MyQuery extends DataQuery {\n    installationId: number;\n    clientId: number;\n    installationVariable?: string;\n    type: string;\n    meta: MetaEntry[];\n    tabledata: boolean;\n    stateOnly: boolean;\n    metaAsFields: boolean;\n    joinDeviceMeta: boolean;\n    linkKey: string;\n    messageFrom: string;\n    groupBy: string;\n    nameBy: string;\n}\n\n\nexport const defaultQuery: Partial<MyQuery> = {\n    installationId: 0,\n    clientId: 0,\n    type: '',\n    meta: [{key: 'type', value: ''}],\n};\n\nexport interface FunctionX {\n    id: number;\n    type: string;\n    meta: { [index: string]: string };\n}\n\nexport interface DeviceX {\n    id: number;\n    type: string;\n    meta: { [index: string]: string };\n}\n\nexport interface Installation {\n    id: number;\n    client_id: number;\n    name: string;\n}\n\n/**\n * These are options configured for each DataSource instance\n */\nexport interface MyDataSourceOptions extends DataSourceJsonData {\n    url?: string;\n    apiKey?: string;\n    oauthPassThru?: boolean;\n    auth?: string;\n}\n\nexport interface MySecureJsonData {\n    apiKey?: string;\n}\n","import {Installation} from \"../types\";\nimport {Select} from \"@grafana/ui\";\nimport React, {useCallback, useMemo} from \"react\";\nimport {SelectableValue} from \"@grafana/data\";\nimport {SelectValue} from \"@grafana/ui/components/Select/types\";\n\n\nexport interface InstallationSelectorProps {\n    isLoading: boolean;\n    installations: Installation[];\n    installation: Installation;\n    onSelection(installation: Installation): void;\n}\n\nexport const InstallationSelector = ({\n                                         isLoading,\n                                         installations,\n                                         installation,\n                                         onSelection\n                                     }: InstallationSelectorProps) => {\n    const installationOptions = useMemo<Array<SelectValue<Installation>>>(() => {\n        return installations.map((installation) => {\n            return {label: installation.name, value: installation};\n        });\n    }, [installations]);\n\n    const currentSelectedInstallation = useMemo<SelectValue<Installation>>(() => {\n        return {label: installation.name, value: installation};\n    }, [installation]);\n\n    const onChange = (event: SelectableValue<Installation>) => {\n        onSelection(event.value ?? installations[0]);\n    }\n\n    const filter = useCallback((option: SelectableValue<Installation>, rawInput: string) => {\n        const input = rawInput.toLowerCase();\n        return option.value?.name?.toLowerCase().includes(input) ?? false;\n    }, []);\n\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                isLoading={isLoading}\n                placeholder={\"Installation\"}\n                noOptionsMessage={\"No available installations\"}\n                filterOption={filter}\n                width={65}\n                options={installationOptions}\n                menuPlacement={'bottom'}\n                onChange={onChange}\n                value={currentSelectedInstallation}\n            />\n        </div>\n    )\n};\n","import React, {MouseEventHandler, useCallback, useMemo} from 'react';\nimport {Button, Select} from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport {MetaEntry} from \"../types\";\n\ntype onDeleteFunction = () => void;\ntype onUpdateFunction = (event: MetaEntry) => void;\n\ninterface FilterEntryProps {\n  data: MetaEntry;\n  onDelete: onDeleteFunction;\n  onUpdate: onUpdateFunction;\n  keys?: string[];\n  values?: string[];\n}\n\n\nexport const FilterEntry = ({data, keys, values, onUpdate, onDelete}: FilterEntryProps) => {\n  const selectableKeys = useMemo<SelectableValue[]>(() => {\n    if (keys) {\n      return keys.map((value) => ({label: value, value: value}))\n    }\n    return []\n  }, [keys]);\n  const selectableValues = useMemo<SelectableValue[]>(() => {\n    if (values) {\n      return values.map((value) => ({label: value, value: value}))\n    }\n    return []\n  }, [values]);\n\n  const currentKey = useMemo<SelectableValue>(() => {\n    return {label: data.key, value: data.key}\n  }, [data]);\n\n  const currentValue = useMemo<SelectableValue>(() => {\n    return {label: data.value, value: data.value}\n  }, [data]);\n\n  const onChangeKey = useCallback((event: SelectableValue) => {\n    onUpdate({...data, key: event.value});\n  }, [data, onUpdate]);\n\n  const onChangeValue = useCallback((event: SelectableValue) => {\n    onUpdate({...data, value: event.value});\n  }, [data, onUpdate]);\n\n  const onCreateKey = useCallback((newValue: string) => {\n    onUpdate({...data, key: newValue})\n  }, [data, onUpdate]);\n\n  const onCreateValue = useCallback((newValue: string) => {\n    onUpdate({...data, value: newValue})\n  }, [data, onUpdate]);\n\n  const deleteEventHandler = useCallback<MouseEventHandler<HTMLButtonElement>>((event) => {\n    event.preventDefault();\n    onDelete();\n  }, [onDelete]);\n\n  return (\n      <div className={'gf-form-inline'}>\n        <div className={'gf-form'}>\n          <span className={'gf-form-label query-keyword'}>key</span>\n          <Select\n              width={30}\n              options={selectableKeys}\n              onChange={onChangeKey}\n              onCreateOption={onCreateKey}\n              value={currentKey}\n              isSearchable={true}\n              allowCustomValue={true}\n              menuPlacement={'bottom'}\n              placeholder={'meta key'}\n          />\n          <span className={'gf-form-label query-keyword'}>match</span>\n          <Select\n              width={30}\n              options={selectableValues}\n              onChange={onChangeValue}\n              onCreateOption={onCreateValue}\n              value={currentValue}\n              isSearchable={true}\n              allowCustomValue={true}\n              menuPlacement={'bottom'}\n              placeholder={'wildcard match'}\n          />\n          <Button variant={'destructive'} onClick={deleteEventHandler} icon={'trash-alt'} />\n        </div>\n      </div>\n  )\n};\n","import {MetaEntry} from \"../types\";\nimport {FilterEntry} from \"./FilterEntry\";\nimport React, {MouseEvent, useCallback} from \"react\";\nimport {Button, VerticalGroup} from \"@grafana/ui\";\n\n\nexport interface MetaEditorProps {\n    entries: MetaEntry[];\n    onUpdate(entries: MetaEntry[]): void;\n    hints?: {[key: string]: string[]};\n}\n\nexport const MetaEditor = ({entries: ents, onUpdate, hints}: MetaEditorProps) => {\n\n    const onMetaDelete = useCallback((idx: number) => {\n        const tmp = ents.filter((value, index) => index !== idx);\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    const onMetaAdd = useCallback((e: MouseEvent) => {\n        onUpdate([...ents, {key: '', value: ''}]);\n        e.preventDefault();\n    }, [ents, onUpdate]);\n\n    const onMetaUpdate = useCallback((idx: number, value: MetaEntry) => {\n        const tmp = ents.map((entry, index) => {\n            if (index === idx) {\n                return value;\n            }\n            return entry;\n        });\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    return (\n        <VerticalGroup>\n            <div className={'gf-form-inline,ui-list'}>\n                {ents.map((value, idx) => {\n                    return (\n                        <FilterEntry\n                            key={idx}\n                            data={value}\n                            onDelete={() => {onMetaDelete(idx)}}\n                            onUpdate={(value) => onMetaUpdate(idx, value)}\n                            keys={hints ? Object.keys(hints):[]}\n                            values={hints ? hints[value.key] ?? []:[]}\n                        />\n                    );\n                })}\n            </div>\n            <div className={'gf-form-inline'} style={{paddingBottom: 10}}>\n                <Button onClick={onMetaAdd} icon={'plus'}>Add filter</Button>\n            </div>\n        </VerticalGroup>\n    )\n};\n","import {MyQuery} from \"../types\";\nimport {\n    VerticalGroup,\n    HorizontalGroup,\n} from \"@grafana/ui\";\nimport React, {FormEvent} from \"react\";\nimport {LabeledSwitch} from \"./form/LabeledSwitch\";\nimport {FormField} from \"./form/FormField\";\n\nexport interface TweakSettingsProps {\n    query: MyQuery;\n\n    onChange(query: MyQuery): void;\n\n    onRunQuery(): void;\n}\n\nconst tooltipGroupBy = (\n    <>\n        Group series by some meta key or payload <code>msg</code> field. Defaults to Function ID.\n    </>\n);\nconst tooltipNameBy = (\n    <>\n        This will name series based on some meta key.\n        <br/>\n        Defaults to <code>name</code>.\n    </>\n);\nconst tooltipMessageFrom = (\n    <>\n        Using this field will join matching functions with the same filter, but the type changed to this field. The\n        msg\n        field will be overwritten by messages matching this type, linked through <code>device_id</code> meta key.\n        Useful\n        for eg. joining positional data. <br/>\n        This field is only applied on table data.\n    </>\n);\n\nexport const TweakSettings = ({query, onChange, onRunQuery}: TweakSettingsProps) => {\n\n    const onGroupByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, groupBy: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onNameByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, nameBy: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onMessageChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, messageFrom: event.currentTarget.value});\n        onRunQuery();\n    }\n\n    const onLinkChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, linkKey: event.currentTarget.value});\n        onRunQuery();\n    }\n    const onSwitchChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({...query, [event.currentTarget.name]: event.currentTarget.checked});\n        onRunQuery();\n    }\n\n    return (\n        <>\n            <VerticalGroup spacing={\"xs\"}>\n                <FormField\n                    name={'groupBy'}\n                    labelWidth={15}\n                    label={'Group by'}\n                    onChange={onGroupByChange}\n                    value={query.groupBy}\n                    placeholder={'Function ID'}\n                    tooltip={tooltipGroupBy}\n                />\n                <FormField\n                    name={'nameBy'}\n                    labelWidth={15}\n                    label={'Name by'}\n                    placeholder={'name'}\n                    onChange={onNameByChange}\n                    value={query.nameBy}\n                    tooltip={tooltipNameBy}\n                />\n                <HorizontalGroup align={\"flex-start\"} spacing={\"xs\"}>\n                    <LabeledSwitch label={\"As table data\"} value={query.tabledata} name={\"tabledata\"}\n                                   onChange={onSwitchChange} labelWidth={15}/>\n                    {query.tabledata && <VerticalGroup spacing={\"xs\"} align={\"flex-start\"}>\n                        <FormField\n                            placeholder={'eg. latitude'}\n                            name={'messageFrom'}\n                            labelWidth={20}\n                            label={'Message from'}\n                            onChange={onMessageChange}\n                            value={query.messageFrom}\n                            tooltip={tooltipMessageFrom}\n                        />\n                        <FormField labelWidth={20} placeholder={'device_id'} name={'linkKey'} label={'Linked with'} onChange={onLinkChange}\n                                   value={query.linkKey}/>\n                        <LabeledSwitch label={\"Meta as fields\"} labelWidth={20} value={query.metaAsFields} name={\"metaAsFields\"}\n                                       onChange={onSwitchChange}/>\n                        {query.metaAsFields && <LabeledSwitch label={\"Add device meta\"} labelWidth={20} name={\"joinDeviceMeta\"}\n                                                              value={query.joinDeviceMeta} onChange={onSwitchChange}/>}\n                    </VerticalGroup>\n                    }\n                </HorizontalGroup>\n                <LabeledSwitch label={\"Current state only\"} value={query.stateOnly} name={\"stateOnly\"}\n                               onChange={onSwitchChange}/>\n            </VerticalGroup>\n        </>\n    )\n}\n","import {getTemplateSrv} from \"@grafana/runtime\";\nimport {Select} from \"@grafana/ui\";\nimport React from \"react\";\n\n\ntype VariableSelectorProps = {\n    value: string;\n    onSelection: (selection: string) => void;\n}\n\nexport const VariableSelector = ({value, onSelection}: VariableSelectorProps) => {\n    const templateSrv = getTemplateSrv();\n    const variables = templateSrv.getVariables();\n    const options = variables.map((variable) => {\n        return {label: variable.name, value: `$\\{${variable.name}}`};\n    });\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                placeholder={\"Variable\"}\n                noOptionsMessage={\"No available variables\"}\n                width={65}\n                options={options}\n                menuPlacement={'bottom'}\n                onChange={(event) => onSelection(event.value ?? '')}\n                value={value}\n            />\n        </div>\n    )\n}\n","import React, {ChangeEvent, useMemo} from \"react\";\nimport {MetaEntry, MyVariableQuery} from \"./types\";\nimport {\n    HorizontalGroup,\n    InlineField,\n    InlineFieldRow,\n    RadioButtonGroup,\n    VerticalGroup\n} from \"@grafana/ui\";\nimport {FormField} from \"./components/form/FormField\";\nimport {MetaEditor} from \"./components/MetaEditor\";\n\nexport interface MyVariableEditorProps {\n    query: MyVariableQuery;\n    onChange: (query: MyVariableQuery) => void;\n}\n\nexport const VariableEditor = ({query, onChange}: MyVariableEditorProps) => {\n\n    const q = useMemo(() => {\n        if (query.queryMode === undefined || query.queryMode === '') {\n            return {...query, queryMode: 'meta', installationId: 0, meta: [], metaKey: ''};\n        }\n        return query;\n    }, [query]);\n    const onChangeNumber = (event: ChangeEvent<HTMLInputElement>) => {\n        const x = parseInt(event.target.value, 10);\n        if (isNaN(x)) {\n            onChange({...q, [event.target.name]: 0});\n        } else {\n            onChange({...q, [event.target.name]: x});\n        }\n    }\n\n    const updateMeta = (meta: MetaEntry[]) => {\n        onChange({...q, meta: meta});\n    }\n\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onChange({...q, [event.target.name]: event.target.value});\n    }\n\n    const queryModeOptions = [\n        {label: 'Meta values', value: 'meta'},\n        {label: 'Installations', value: 'installation'},\n    ];\n\n    return (\n        <VerticalGroup spacing={\"xs\"}>\n            <HorizontalGroup spacing={\"xs\"}>\n                <InlineFieldRow>\n                    <InlineField label={\"Query mode\"} labelWidth={15}>\n                        <RadioButtonGroup options={queryModeOptions} value={q.queryMode} onChange={(v) => {\n                            onChange({...q, queryMode: v ?? 'meta'});\n                        }}/>\n                    </InlineField>\n                </InlineFieldRow>\n            </HorizontalGroup>\n            {q.queryMode === 'meta' &&\n                <VerticalGroup>\n                    <HorizontalGroup>\n                        <FormField label={\"Installation ID\"} placeholder={\"ID\"}\n                                   value={q.installationId?.toString() ?? 0}\n                                   name={\"installationId\"}\n                                   onChange={onChangeNumber} labelWidth={15}/>\n                        <FormField label={\"Meta key\"} placeholder={\"name\"} labelWidth={15} value={query.metaKey ?? ''}\n                                   name={\"metaKey\"}\n                                   onChange={onChangeText}/>\n                    </HorizontalGroup>\n                    <MetaEditor entries={q.meta ?? []} onUpdate={updateMeta}/>\n                </VerticalGroup>\n            }\n        </VerticalGroup>\n    )\n}\n","import { DataSource } from './DataSource';\nimport { ConfigEditor } from './ConfigEditor';\nimport { QueryEditor } from './QueryEditor';\nimport { MyQuery, MyDataSourceOptions } from './types';\nimport { DataSourcePlugin } from '@grafana/data';\nimport {VariableEditor} from \"./VariableEditor\";\n\nexport const plugin = new DataSourcePlugin<DataSource, MyQuery, MyDataSourceOptions>(DataSource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditor(QueryEditor)\n  .setVariableQueryEditor(VariableEditor);\n","import React, {useState, useEffect, useMemo, useCallback} from 'react';\nimport {DataSource} from './DataSource';\nimport {MyQuery, MyDataSourceOptions, Installation, FunctionX, MetaEntry, defaultQuery} from './types';\nimport {QueryEditorProps} from '@grafana/data';\nimport {InstallationSelector} from \"./components/InstallationSelector\";\nimport {MetaEditor} from \"./components/MetaEditor\";\nimport {TweakSettings} from \"./components/TweakSettings\";\nimport {useBackoffCallback} from \"./components/useBackoffCallback\";\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\nimport {InlineFieldRow} from \"@grafana/ui\";\nimport {VariableSelector} from \"./components/VariableSelector\";\n\ntype Props = QueryEditorProps<DataSource, MyQuery, MyDataSourceOptions>;\n\nexport const QueryEditor = ({onChange, query, onRunQuery, datasource}: Props) => {\n    const [installations, setInstallations] = useState<Installation[]>([])\n    const [loadingInstallations, setLoadingInstallations] = useState<boolean>(true)\n\n    const squery = useMemo(() => {\n        let q = query;\n        if (q.installationId === undefined) {\n            q = {...q, ...defaultQuery};\n            onChange(q);\n        }\n        return q;\n    }, [query, onChange])\n\n    const [functions, setFunctions] = useState<FunctionX[]>([])\n    const [loadingFunctions, setLoadingFunctions] = useState<boolean>(false)\n\n    const [selectedInstallation, setSelectedInstallation] = useState<Installation>({id: 0, name: '', client_id: 0})\n\n    const onRunQueryTimed = useBackoffCallback(onRunQuery, 250);\n\n    useEffect(() => {\n        datasource.fetchInstallations().then(installations => {\n            let tmpInstallation: Installation | undefined = installations.find(i => i.id === query.installationId);\n            if (tmpInstallation === undefined && installations.length === 0) {\n                tmpInstallation = {id: 0, name: 'No installations available', client_id: 0};\n            }\n            if (tmpInstallation === undefined && installations.length > 0) {\n                tmpInstallation = installations[0];\n            }\n            setSelectedInstallation(tmpInstallation!);\n            setInstallations(installations);\n        }).finally(() => {\n            setLoadingInstallations(false)\n        });\n    }, []); // eslint-disable-line\n\n    useEffect(() => {\n        if (selectedInstallation.id === 0) {\n            return\n        }\n        setLoadingFunctions(true);\n        datasource.fetchFunctions(Number(selectedInstallation.id)).then(functions => {\n            setFunctions(functions);\n            onRunQueryTimed();\n        }).finally(() => {\n            setLoadingFunctions(false)\n        });\n    }, [setLoadingFunctions, selectedInstallation, setFunctions, datasource, onRunQueryTimed]);\n\n    const onUpdateMeta = useCallback((entries: MetaEntry[]) => {\n        onChange({...squery, meta: entries});\n        onRunQueryTimed();\n    }, [onChange, squery, onRunQueryTimed]);\n\n    useEffect(() => {\n        if (selectedInstallation.id !== 0 &&\n            selectedInstallation.id !== squery.installationId &&\n            selectedInstallation.client_id !== squery.clientId) {\n            onChange({...squery, installationId: selectedInstallation.id, clientId: selectedInstallation.client_id});\n        }\n    }, [selectedInstallation, squery, onChange])\n\n    const hints = useMemo(() => {\n        const res: { [key: string]: string[] } = {};\n        for (const func of functions) {\n            if (res[\"type\"] === undefined) {\n                res[\"type\"] = [func.type];\n            } else {\n                if (res[\"type\"].indexOf(func.type) === -1) {\n                    res[\"type\"].push(func.type);\n                }\n            }\n            for (const metaKey in func.meta) {\n                if (res[metaKey] === undefined) {\n                    res[metaKey] = [];\n                }\n                if (res[metaKey].indexOf(func.meta[metaKey]) === -1) {\n                    res[metaKey].push(func.meta[metaKey]);\n                }\n            }\n        }\n        return res;\n    }, [functions]);\n\n    const setInstallationVariable = (variable?: string) => {\n        onChange({...squery, installationVariable: variable});\n    };\n\n    return (\n        <div className={'section gf-form-group'}>\n            <InlineFieldRow>\n                {squery.installationVariable === undefined ?\n                    <InstallationSelector isLoading={loadingInstallations || loadingFunctions}\n                                          installations={installations}\n                                          installation={selectedInstallation}\n                                          onSelection={setSelectedInstallation}/> :\n                    <VariableSelector value={squery.installationVariable} onSelection={setInstallationVariable}/>}\n                <LabeledSwitch label={\"From variable\"} name={\"useVariable\"}\n                               value={squery.installationVariable !== undefined} onChange={(e) => {\n                    if (e.currentTarget.checked) {\n                        setInstallationVariable('');\n                    } else {\n                        setInstallationVariable(undefined);\n                    }\n                }}/>\n            </InlineFieldRow>\n            <MetaEditor entries={squery.meta || []}\n                        onUpdate={onUpdateMeta}\n                        hints={hints}\n            />\n            <TweakSettings query={query} onChange={onChange} onRunQuery={onRunQueryTimed}/>\n        </div>\n    )\n};\n","import {useCallback, useRef} from \"react\";\nexport const useBackoffCallback = (fn: () => void, delay: number) => {\n    const ticker = useRef<number>();\n    return useCallback(() => {\n        if (ticker.current !== undefined) {\n            window.clearTimeout(ticker.current);\n        }\n        ticker.current = window.setTimeout(fn, delay);\n    }, [fn, delay]);\n}\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__305__","__WEBPACK_EXTERNAL_MODULE__545__","__WEBPACK_EXTERNAL_MODULE__388__","__WEBPACK_EXTERNAL_MODULE__980__","__WEBPACK_EXTERNAL_MODULE__650__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","DataSource","DataSourceWithBackend","fetchInstallations","getBackendSrv","datasourceRequest","method","url","this","settings","then","result","data","fetchFunctions","installationId","meta","q","keys","map","encodeURIComponent","join","query","options","console","log","templateSrv","getTemplateSrv","targets","installationVariable","toNumber","replace","super","findMetaQuery","metaKey","Promise","resolve","filter","reduce","acc","functions","func","find","f","text","metricFindQuery","queryMode","installations","installation","name","id","constructor","instanceSettings","FormField","type","tooltip","label","placeholder","onChange","labelWidth","width","InlineField","grow","Input","LabeledSwitch","InlineFieldRow","InlineSwitch","defaultQuery","clientId","InstallationSelector","isLoading","onSelection","installationOptions","useMemo","currentSelectedInstallation","useCallback","option","rawInput","input","toLowerCase","includes","div","className","Select","noOptionsMessage","filterOption","menuPlacement","event","FilterEntry","values","onUpdate","onDelete","selectableKeys","selectableValues","currentKey","currentValue","onChangeKey","onChangeValue","onCreateKey","newValue","onCreateValue","deleteEventHandler","preventDefault","span","onCreateOption","isSearchable","allowCustomValue","Button","variant","onClick","icon","MetaEditor","entries","ents","hints","onMetaDelete","idx","tmp","index","onMetaAdd","e","onMetaUpdate","entry","VerticalGroup","style","paddingBottom","tooltipGroupBy","code","tooltipNameBy","br","tooltipMessageFrom","TweakSettings","onRunQuery","onSwitchChange","currentTarget","checked","spacing","groupBy","nameBy","HorizontalGroup","align","tabledata","messageFrom","linkKey","metaAsFields","joinDeviceMeta","stateOnly","VariableSelector","getVariables","variable","plugin","DataSourcePlugin","setConfigEditor","onOptionsChange","secureJsonData","jsonData","secureJsonFields","migrated","setMigrated","React","useEffect","apiKey","newJsonData","target","oauthPassThru","Alert","title","severity","p","setQueryEditor","datasource","setInstallations","useState","loadingInstallations","setLoadingInstallations","squery","setFunctions","loadingFunctions","setLoadingFunctions","selectedInstallation","setSelectedInstallation","client_id","onRunQueryTimed","fn","delay","ticker","useRef","current","window","clearTimeout","setTimeout","useBackoffCallback","tmpInstallation","i","length","finally","Number","onUpdateMeta","res","indexOf","push","setInstallationVariable","setVariableQueryEditor","RadioButtonGroup","v","toString","x","parseInt","isNaN"],"sourceRoot":""}