{"version":3,"file":"module.js","mappings":";sIAAAA,EAAOC,QAAUC,C,UCAjBF,EAAOC,QAAUE,C,QCAjBH,EAAOC,QAAUG,C,UCAjBJ,EAAOC,QAAUI,C,UCAjBL,EAAOC,QAAUK,C,UCAjBN,EAAOC,QAAUM,C,GCCbC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaV,QAGrB,IAAID,EAASQ,EAAyBE,GAAY,CAGjDT,QAAS,CAAC,GAOX,OAHAY,EAAoBH,GAAUV,EAAQA,EAAOC,QAASQ,GAG/CT,EAAOC,OACf,CCrBAQ,EAAoBK,EAAKd,IACxB,IAAIe,EAASf,GAAUA,EAAOgB,WAC7B,IAAOhB,EAAiB,QACxB,IAAM,EAEP,OADAS,EAAoBQ,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdN,EAAoBQ,EAAI,CAAChB,EAASkB,KACjC,IAAI,IAAIC,KAAOD,EACXV,EAAoBY,EAAEF,EAAYC,KAASX,EAAoBY,EAAEpB,EAASmB,IAC5EE,OAAOC,eAAetB,EAASmB,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDX,EAAoBY,EAAI,CAACK,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFlB,EAAoBsB,EAAK9B,IACH,oBAAX+B,QAA0BA,OAAOC,aAC1CX,OAAOC,eAAetB,EAAS+B,OAAOC,YAAa,CAAEC,MAAO,WAE7DZ,OAAOC,eAAetB,EAAS,aAAc,CAAEiC,OAAO,GAAO,ECL9DzB,EAAoB0B,EAAI,qC,4DCGxB,IACE,KAAiB,QACb,QAAkBC,MAAM,EAAG,QAAkBC,YAAY,KAAO,GAChE,qC,85BCAC,MAAMC,UAAmBC,EAAAA,sBAQ5BC,kBAAAA,GACI,OAAOC,EAAAA,EAAAA,iBACFC,kBAAkB,CACfC,OAAQ,MACRC,IAAK,GAAGC,KAAKC,SAASF,gCAEzBG,MAAKC,GAAUA,EAAOC,MAC/B,CAEAC,cAAAA,CAAeC,EAAwBC,GACnC,MAAMC,EAAID,EAAO9B,OAAOgC,KAAKF,GAAMG,KAAInC,GAAO,GAAGoC,mBAAmBpC,MAAQoC,mBAAmBJ,EAAKhC,QAASqC,KAAK,KAAO,GACzH,OAAOhB,EAAAA,EAAAA,iBACFC,kBAAkB,CACfC,OAAQ,MACRC,IAAK,GAAGC,KAAKC,SAASF,wBAAwBO,KAAkBE,MAEnEN,MAAKC,GAAUA,EAAOC,MAC/B,CAEAS,YAAAA,CAAaP,EAAwBC,GACjC,MAAMC,EAAID,EAAO9B,OAAOgC,KAAKF,GAAMG,KAAInC,GAAO,GAAGoC,mBAAmBpC,MAAQoC,mBAAmBJ,EAAKhC,QAASqC,KAAK,KAAO,GACzH,OAAOhB,EAAAA,EAAAA,iBACFC,kBAAkB,CACfC,OAAQ,MACRC,IAAK,GAAGC,KAAKC,SAASF,sBAAsBO,KAAkBE,MAEjEN,MAAKC,GAAUA,EAAOC,MAC/B,CAEAU,KAAAA,CAAMC,GACF,MAAMC,GAAcC,EAAAA,EAAAA,kBACdC,EAAUH,EAAQG,QAAQR,KAAIrB,GACzB,OACAA,GAAAA,CAAOiB,eAAgBjB,EAAM8B,sBAAuBC,EAAAA,EAAAA,UAASJ,EAAYK,QAAQhC,EAAM8B,uBAAyB9B,EAAMiB,eACzHC,KAAMlB,EAAMkB,KAAKG,KAAIH,IACV,CACHhC,IAAKyC,EAAYK,QAAQd,EAAKhC,KAC9Bc,MAAO2B,EAAYK,QAAQd,EAAKlB,UAErCA,OAGX,OAAOiC,MAAMR,MAAM,OAAIC,GAAAA,CAASG,YACpC,CAEAK,QAAAA,CAASC,EAAqBC,GAC1B,MAAMC,EAAY,CAAC,EASnB,OARAjD,OAAOgC,KAAKgB,EAAalB,MAAMoB,SAAQpD,IACnCmD,EAAInD,GAAOkD,EAAalB,KAAKhC,EAAI,IAElCiD,SACC/C,OAAOgC,KAAKe,EAAWjB,MAAMoB,SAAQpD,IACjCmD,EAAI,WAAWnD,KAASiD,EAAWjB,KAAKhC,EAAI,IAG7CmD,CACX,CAEAE,aAAAA,CAAcd,EAAwBC,GAClC,GAAsB,KAAlBD,EAAMe,SAA2C,MAAzBf,EAAMR,gBAAmD,KAAzBQ,EAAMR,eAC9D,OAAOwB,QAAQC,QAAQ,IAE3B,IAAIC,GAAKZ,EAAAA,EAAAA,UAASN,EAAMR,gBACxB,GAAoC,iBAAzBQ,EAAMR,gBAA+BQ,EAAMR,eAAe2B,SAAS,KAAM,CAChF,MAAMC,GAAMjB,EAAAA,EAAAA,kBAAiBI,QAAQP,EAAMR,gBAC3C0B,GAAKZ,EAAAA,EAAAA,UAASc,EAClB,CACA,GAAIC,MAAMH,GACN,OAAOF,QAAQM,OAAO,4BAA4BtB,EAAMR,qBAAqB0B,KAEjF,MAAMK,EAASvB,EAAMP,KAAOO,EAAMP,KAAK+B,QAAkC,CAACC,EAAKhC,KAC1D,KAAbA,EAAKhC,KAA6B,KAAfgC,EAAKlB,QACxBkD,EAAIhC,EAAKhC,KAAOgC,EAAKlB,OAElBkD,IACR,CAAC,GAAK,CAAC,EACV,OAAGzB,EAAM0B,cACExC,KAAKa,aAAamB,GAAI9B,MAAKuC,IAC9B,MAAMC,EAAsCD,EAAQH,QAAmC,CAACC,EAAKI,KACzFJ,EAAI,GAAGI,EAAOX,MAAQW,EACfJ,IACR,CAAC,GACJ,OAAOvC,KAAKK,eAAe2B,EAAIK,GAAQnC,MAAK0C,GACjCA,EAAUN,QAA0B,CAACC,EAAKM,KAC7C,MAAMC,EAAMJ,EAAUG,EAAKtC,KAAgB,WACrCA,EAAOP,KAAKuB,SAASuB,EAAID,GAC/B,IAAKN,EAAIQ,MAAKC,GAAKA,EAAEC,OAAS1C,EAAKO,EAAMe,YAAatB,EAAKO,EAAMe,SAAU,CACvE,GAAyB,KAAtBf,EAAMoC,aAAsB3C,EAAKO,EAAMoC,aAAc,CACpD,MAAMC,EAA6B,SAAtBrC,EAAMoC,YAAyBL,EAAKO,KAAO7C,EAAKO,EAAMoC,aACnE,MAAO,IAAIX,EAAK,CAACU,KAAME,EAAM9D,MAAOkB,EAAKO,EAAMe,UACnD,CACI,MAAO,IAAIU,EAAK,CAACU,KAAM1C,EAAK,GAAGO,EAAMe,WAAYxC,MAAOkB,EAAKO,EAAMe,UAE3E,CACA,OAAOU,CAAG,GACX,MACJrC,MAAKC,GACGA,GACT,IACHD,MAAKC,GACGA,IAGRH,KAAKK,eAAe2B,EAAIK,GAAQnC,MAAK0C,GACjCA,EAAUN,QAA0B,CAACC,EAAKM,KAC7C,IAAKN,EAAIQ,MAAKC,GAAKA,EAAEC,OAASJ,EAAKtC,KAAKO,EAAMe,YAAagB,EAAKtC,KAAKO,EAAMe,SAAU,CACjF,GAAyB,KAAtBf,EAAMoC,aAAsBL,EAAKtC,KAAKO,EAAMoC,aAAc,CACzD,MAAMC,EAA6B,SAAtBrC,EAAMoC,YAAyBL,EAAKO,KAAOP,EAAKtC,KAAKO,EAAMoC,aACxE,MAAO,IAAIX,EAAK,CAACU,KAAME,EAAM9D,MAAOwD,EAAKtC,KAAKO,EAAMe,UACxD,CACI,MAAO,IAAIU,EAAK,CAACU,KAAMJ,EAAKtC,KAAKO,EAAMe,SAAUxC,MAAOwD,EAAKtC,KAAKO,EAAMe,UAEhF,CACA,OAAOU,CAAG,GACX,MACJrC,MAAKC,GACGA,GAEf,CAEAkD,eAAAA,CAAgBvC,EAAwBC,GAEpC,MACS,kBAFED,EAAMwC,UAAYxC,EAAMwC,UAAY,gBAGhCtD,KAAKL,qBAAqBO,MAAKqD,GAC3BA,EAAcjB,QAA0B,CAACC,EAAKiB,IAC1C,IAAIjB,EAAK,CAACU,KAAMO,EAAaL,KAAM9D,MAAOmE,EAAaxB,MAC/D,MAKAhC,KAAK4B,cAAcd,EAAOC,EAG7C,CA5IA0C,WAAAA,CAAYC,GACRpC,MAAMoC,GAHV,OAAQzD,gBAAR,GAIID,KAAKC,SAAWyD,CACpB,E,6BCGG,MAAMC,EAAY,EAAEP,OAAMQ,UAASC,QAAOC,cAAaX,OAAM9D,QAAO0E,WAAUC,aAAa,OAAQC,WAElG,kBAACC,EAAAA,YAAWA,CAACL,MAAOA,EAAOG,WAAYA,EAAYJ,QAASA,EAASO,MAAM,GACvE,kBAACC,EAAAA,MAAKA,CAAChB,KAAMA,EAAMD,KAAMA,EAAMW,YAAaA,EAAazE,MAAOA,EAAO0E,SAAUA,EAAWE,MAAOA,KCPlGI,EAAgB,EAAER,QAAOxE,QAAO8D,OAAMY,WAAUC,aAAa,UAElE,kBAACM,EAAAA,eAAcA,KACX,kBAACJ,EAAAA,YAAWA,CAACL,MAAOA,EAAOG,WAAYA,GACnC,kBAACO,EAAAA,aAAYA,CAAClF,MAAOA,EAAO8D,KAAMA,EAAMY,SAAUA,M,w4BCL3D,MC0BMS,EAAiC,CAC1ClE,eAAgB,EAChB8C,KAAM,GACN7C,KAAM,CAAC,CAAEhC,IAAK,OAAQc,MAAO,MCzBpBoF,EAAuB,EAChCC,YACAnB,gBACAC,eACAmB,kBAEA,MAAMC,GAAsBC,EAAAA,EAAAA,UAA0C,IAC3DtB,EAAc7C,KAAK8C,IACf,CAAEK,MAAOL,EAAaL,KAAM9D,MAAOmE,OAE/C,CAACD,IAEEuB,GAA8BD,EAAAA,EAAAA,UAAmC,KAC5D,CAAEhB,MAAOL,EAAaL,KAAM9D,MAAOmE,KAC3C,CAACA,IAMEnB,GAAS0C,EAAAA,EAAAA,cAAY,CAACC,EAAuCC,K,IAExDD,EAAAA,EADP,MAAME,EAAQD,EAASE,c,IAChBH,EAAP,OAAkDE,QAA3CF,EAAY,QAAZA,EAAAA,EAAO3F,aAAP2F,IAAAA,GAAkB,QAAlBA,EAAAA,EAAc7B,YAAd6B,IAAAA,OAAAA,EAAAA,EAAoBG,cAAclD,SAASiD,UAA3CF,IAAAA,GAAAA,CAA0D,GAClE,IAEH,OACI,kBAACI,MAAAA,CAAIC,UAAW,kBACZ,kBAACC,EAAAA,OAAMA,CACHZ,UAAWA,EACXZ,YAAa,eACbyB,iBAAkB,6BAClBC,aAAcnD,EACd4B,MAAO,GACPlD,QAAS6D,EACTa,cAAe,SACf1B,SAnBM2B,I,IACFA,EAAZf,EAAuB,QAAXe,EAAAA,EAAMrG,aAANqG,IAAAA,EAAAA,EAAenC,EAAc,GAAG,EAmBpClE,MAAOyF,I,04BCjChB,MAAMa,EAAc,EAAGvF,OAAMK,OAAMmF,SAAQC,WAAUC,eAC1D,MAAMC,GAAiBlB,EAAAA,EAAAA,UAA2B,IAC5CpE,EACKA,EAAKC,KAAKrB,IAAW,CAAEwE,MAAOxE,EAAOA,MAAOA,MAE9C,IACN,CAACoB,IACEuF,GAAmBnB,EAAAA,EAAAA,UAA2B,IAC9Ce,EACKA,EAAOlF,KAAKrB,IAAW,CAAEwE,MAAOxE,EAAOA,MAAOA,MAEhD,IACN,CAACuG,IAEEK,GAAapB,EAAAA,EAAAA,UAAyB,KACnC,CAAEhB,MAAOzD,EAAK7B,IAAKc,MAAOe,EAAK7B,OACrC,CAAC6B,IAEE8F,GAAerB,EAAAA,EAAAA,UAAyB,KACrC,CAAEhB,MAAOzD,EAAKf,MAAOA,MAAOe,EAAKf,SACvC,CAACe,IAEE+F,GAAcpB,EAAAA,EAAAA,cAAaW,IAC/BG,EAAS,OAAKzF,GAAAA,CAAM7B,IAAKmH,EAAMrG,Q,GAC9B,CAACe,EAAMyF,IAEJO,GAAgBrB,EAAAA,EAAAA,cAAaW,IACjCG,EAAS,OAAKzF,GAAAA,CAAMf,MAAOqG,EAAMrG,Q,GAChC,CAACe,EAAMyF,IAEJQ,GAActB,EAAAA,EAAAA,cAAauB,IAC/BT,EAAS,OAAKzF,GAAAA,CAAM7B,IAAK+H,I,GACxB,CAAClG,EAAMyF,IAEJU,GAAgBxB,EAAAA,EAAAA,cAAauB,IACjCT,EAAS,OAAKzF,GAAAA,CAAMf,MAAOiH,I,GAC1B,CAAClG,EAAMyF,IAEJW,GAAqBzB,EAAAA,EAAAA,cAAmDW,IAC5EA,EAAMe,iBACNX,GAAU,GACT,CAACA,IAEJ,OACE,kBAACV,MAAAA,CAAIC,UAAW,kBACd,kBAACD,MAAAA,CAAIC,UAAW,WACd,kBAACqB,OAAAA,CAAKrB,UAAW,+BAA+B,OAChD,kBAACC,EAAAA,OAAMA,CACLrB,MAAO,GACPlD,QAASgF,EACThC,SAAUoC,EACVQ,eAAgBN,EAChBhH,MAAO4G,EACPW,cAAc,EACdC,kBAAkB,EAClBpB,cAAe,SACf3B,YAAa,aAEf,kBAAC4C,OAAAA,CAAKrB,UAAW,+BAA+B,SAChD,kBAACC,EAAAA,OAAMA,CACLrB,MAAO,GACPlD,QAASiF,EACTjC,SAAUqC,EACVO,eAAgBJ,EAChBlH,MAAO6G,EACPU,cAAc,EACdC,kBAAkB,EAClBpB,cAAe,SACf3B,YAAa,mBAEf,kBAACgD,EAAAA,OAAMA,CAACC,QAAS,cAAeC,QAASR,EAAoBS,KAAM,e,EC3E9DC,EAAa,EAAEC,QAASC,EAAMvB,WAAUwB,YAEjD,MAAMC,GAAevC,EAAAA,EAAAA,cAAawC,IAC9B,MAAMrF,EAAMkF,EAAK/E,QAAO,CAAChD,EAAOmI,IAAUA,IAAUD,IACpD1B,EAAS3D,EAAI,GACd,CAACkF,EAAMvB,IAEJ4B,GAAY1C,EAAAA,EAAAA,cAAa2C,IAC3B7B,EAAS,IAAIuB,EAAM,CAAC7I,IAAK,GAAIc,MAAO,MACpCqI,EAAEjB,gBAAgB,GACnB,CAACW,EAAMvB,IAEJ8B,GAAe5C,EAAAA,EAAAA,cAAY,CAACwC,EAAalI,KAC3C,MAAM6C,EAAMkF,EAAK1G,KAAI,CAACkH,EAAOJ,IACrBA,IAAUD,EACHlI,EAEJuI,IAEX/B,EAAS3D,EAAI,GACd,CAACkF,EAAMvB,IAEV,OACI,kBAACgC,EAAAA,cAAaA,KACV,kBAACzC,MAAAA,CAAIC,UAAW,0BACX+B,EAAK1G,KAAI,CAACrB,EAAOkI,K,IAQUF,EAPxB,OACI,kBAAC1B,EAAWA,CACRpH,IAAKgJ,EACLnH,KAAMf,EACNyG,SAAU,KAAOwB,EAAaC,EAAI,EAClC1B,SAAWxG,GAAUsI,EAAaJ,EAAKlI,GACvCoB,KAAM4G,EAAQ5I,OAAOgC,KAAK4G,GAAO,GACjCzB,OAAQyB,GAAwB,QAAhBA,EAAAA,EAAMhI,EAAMd,YAAZ8I,IAAAA,EAAAA,EAAuB,I,KAKvD,kBAACjC,MAAAA,CAAIC,UAAW,iBAAkByC,MAAO,CAACC,cAAe,KACrD,kBAACjB,EAAAA,OAAMA,CAACE,QAASS,EAAWR,KAAM,QAAQ,iB,w4BClC1D,MAAMe,EACF,oCAAE,4CAC2C,kBAACC,OAAAA,KAAK,OAAU,oCAG3DC,EACF,oCAAE,gDAEE,kBAACC,KAAAA,MAAK,eACM,kBAACF,OAAAA,KAAK,QAAW,KAG/BG,EACF,oCAAE,4LAG2E,kBAACH,OAAAA,KAAK,aAAgB,sDAE9D,kBAACE,KAAAA,MAAK,6CAKlCE,EAAgB,EAAGvH,QAAOiD,WAAUuE,iBAE7C,MAmBMC,EAAkB7C,IACpB3B,EAAS,OAAKjD,GAAAA,CAAO,CAAC4E,EAAM8C,cAAcrF,MAAOuC,EAAM8C,cAAcC,WACrEH,GAAY,EAOhB,OACI,oCACI,kBAACT,EAAAA,cAAaA,CAACa,QAAS,MACpB,kBAAC/E,EAASA,CACNR,KAAM,UACNa,WAAY,GACZH,MAAO,WACPE,SAnCS2B,IACrB3B,EAAS,OAAKjD,GAAAA,CAAO6H,QAASjD,EAAM8C,cAAcnJ,SAClDiJ,GAAY,EAkCAjJ,MAAOyB,EAAM6H,QACb7E,YAAa,cACbF,QAASoE,IAEb,kBAACrE,EAASA,CACNR,KAAM,SACNa,WAAY,GACZH,MAAO,UACPC,YAAa,OACbC,SAxCQ2B,IACpB3B,EAAS,OAAKjD,GAAAA,CAAO8H,OAAQlD,EAAM8C,cAAcnJ,SACjDiJ,GAAY,EAuCAjJ,MAAOyB,EAAM8H,OACbhF,QAASsE,IAEb,kBAACW,EAAAA,gBAAeA,CAACC,MAAO,aAAcJ,QAAS,MAC3C,kBAACrE,EAAaA,CAACR,MAAO,gBAAiBxE,MAAOyB,EAAMiI,UAAW5F,KAAM,YACjEY,SAAUwE,EAAgBvE,WAAY,KACzClD,EAAMiI,WAAa,kBAAClB,EAAAA,cAAaA,CAACa,QAAS,KAAMI,MAAO,cACrD,kBAACnF,EAASA,CACNG,YAAa,eACbX,KAAM,cACNa,WAAY,GACZH,MAAO,eACPE,SAhDC2B,IACrB3B,EAAS,OAAKjD,GAAAA,CAAOkI,YAAatD,EAAM8C,cAAcnJ,SACtDiJ,GAAY,EA+CQjJ,MAAOyB,EAAMkI,YACbpF,QAASwE,IAEb,kBAACzE,EAASA,CAACK,WAAY,GAAIF,YAAa,YAAaX,KAAM,UAAWU,MAAO,cAAeE,SA/C1F2B,IAClB3B,EAAS,OAAKjD,GAAAA,CAAOmI,QAASvD,EAAM8C,cAAcnJ,SAClDiJ,GAAY,EA8CQjJ,MAAOyB,EAAMmI,UACjB,kBAAC5E,EAAaA,CAACR,MAAO,iBAAkBG,WAAY,GAAI3E,MAAOyB,EAAMoI,aAAc/F,KAAM,eACrFY,SAAUwE,IACbzH,EAAMoI,cAAgB,kBAAC7E,EAAaA,CAACR,MAAO,kBAAmBG,WAAY,GAAIb,KAAM,iBAClF9D,MAAOyB,EAAMqI,eAAgBpF,SAAUwE,MAKnD,kBAAClE,EAAaA,CAACR,MAAO,qBAAsBxE,MAAOyB,EAAMsI,UAAWjG,KAAM,YACtEY,SAAUwE,EAAgBvE,WAAY,KAC1C,kBAACK,EAAaA,CAACR,MAAO,iBAAkBV,KAAM,eAAgB9D,MAAOyB,EAAMuI,aACvEtF,SApDc2B,IAC1B3B,EAAS,OAAKjD,GAAAA,CAAO,CAAC4E,EAAM8C,cAAcrF,MAAOuC,EAAM8C,cAAcC,WACrEH,GAAY,EAkDgCtE,WAAY,M,EC3GnDsF,EAAmB,EAAEjK,QAAOsF,kBACrC,MAEM5D,GAFcE,EAAAA,EAAAA,kBACUsI,eACJ7I,KAAK8I,IACpB,CAAC3F,MAAO2F,EAASrG,KAAM9D,MAAO,MAAMmK,EAASrG,YAExD,OACI,kBAACiC,MAAAA,CAAIC,UAAW,kBACZ,kBAACC,EAAAA,OAAMA,CACHxB,YAAa,WACbyB,iBAAkB,yBAClBtB,MAAO,GACPlD,QAASA,EACT0E,cAAe,SACf1B,SAAW2B,I,IAAsBA,E,OAAZf,EAAuB,QAAXe,EAAAA,EAAMrG,aAANqG,IAAAA,EAAAA,EAAe,GAAG,EACnDrG,MAAOA,I,04BCbvB,MAAMoK,EAAqD,CACvD,CAAE5F,MAAO,UAAWxE,MAAO,OAC3B,CAAEwE,MAAO,QAASxE,MAAO,SACzB,CAAEwE,MAAO,QAASxE,MAAO,SACzB,CAAEwE,MAAO,OAAQxE,MAAO,QACxB,CAAEwE,MAAO,MAAOxE,MAAO,OACvB,CAAEwE,MAAO,SAAUxE,MAAO,UAC1B,CAAEwE,MAAO,MAAOxE,MAAO,OACvB,CAAEwE,MAAO,gBAAiBxE,MAAO,kBACjC,CAAEwE,MAAO,gBAAiBxE,MAAO,kBACjC,CAAEwE,MAAO,gBAAiBxE,MAAO,kBACjC,CAAEwE,MAAO,gBAAiBxE,MAAO,kBACjC,CAAEwE,MAAO,SAAUxE,MAAO,UAC1B,CAAEwE,MAAO,qBAAsBxE,MAAO,UACtC,CAAEwE,MAAO,MAAOxE,MAAO,QAGrBqK,EACF,oCACI,kBAACpK,IAAAA,KAAE,+DAEC,kBAAC6I,KAAAA,MAAK,yFAMLwB,EAA0D,EAAG7I,QAAOiD,WAAUuE,iB,IAmCxDxH,EApB/B,OACI,oCACI,kBAACsE,MAAAA,CAAI0C,MAAO,CAAE8B,aAAc,SACxB,kBAACf,EAAAA,gBAAeA,CAACC,MAAO,aAAcJ,QAAS,MAC3C,kBAAC7E,QAAAA,CAAMwB,UAAU,uBAAsB,sBACvC,kBAACD,MAAAA,KACG,kBAACE,EAAAA,OAAMA,CACHrB,MAAO,GACPlD,QAAS0I,EACTpK,MAAOyB,EAAM+I,WAAaJ,EAAmB1G,MAAK+G,GAAKA,EAAEzK,QAAUyB,EAAM+I,kBAAc9L,EACvFgG,SAxBI1E,IACxB0E,EAAS,OACFjD,GAAAA,CACH+I,YAAYxK,aAAAA,EAAAA,EAAOA,QAAS,GAC5B0K,cAAc1K,aAAAA,EAAAA,EAAOA,OAAQyB,EAAMiJ,aAAe,MAEtDzB,GAAY,EAmBQ0B,aAAa,KAGrB,kBAAC5E,MAAAA,KACG,kBAACzB,EAASA,CACNR,KAAM,eACNU,MAAO,WACPD,QAAS8F,EACTzF,MAAO,GACP5E,MAAyB,QAAlByB,EAAAA,EAAMiJ,oBAANjJ,IAAAA,EAAAA,EAAsB,GAC7BiD,SA1BM2B,IAC1B3B,EAAS,OAAKjD,GAAAA,CAAOiJ,aAAcrE,EAAM8C,cAAcnJ,SACvDiJ,GAAY,EAyBQxE,YAAa,Y,kxDC1DlC,MCXMmG,EAAS,I,OAAIC,kBAA2DzK,GAClF0K,iBTEyB,EAAEC,kBAAiBrJ,cAC3C,MAAM,SAACsJ,EAAQ,eAAEC,EAAc,iBAAEC,GAAoBxJ,GAC9CyJ,EAAUC,GAAeC,IAAAA,UAAe,G,IA4DjBJ,EAhB9B,OAbAK,EAAAA,EAAAA,YAAU,KACN,QAAgC5M,IAA5BgD,EAAQsJ,SAASO,QAAoD,KAA5B7J,EAAQsJ,SAASO,OAAe,CACzEH,GAAY,GACZ,IAAII,EAAc,KAAIR,UACfQ,EAAYD,OACnBR,EAAgB,OACTrJ,GAAAA,CACHuJ,eAAgB,OAAIA,GAAAA,CAAgBM,OAAQ7J,EAAQsJ,SAASO,SAC7DP,SAAUQ,IAElB,IACD,IAGC,kBAAChD,EAAAA,cAAaA,CAACa,QAAS,QACpB,kBAAC/E,EAASA,CAACE,MAAO,MACPxE,MAAO0B,EAAQsJ,SAAStK,KAAO,GAC/BoD,KAAM,MACNW,YAAa,yCACbC,SAjDG2B,IAClB0E,EAAgB,OACTrJ,GAAAA,CACHsJ,SAAU,OACHA,GAAAA,CACH,CAAC3E,EAAMoF,OAAO3H,MAAOuC,EAAMoF,OAAOzL,U,EA6C3B2E,WAAY,GACZC,MAAO,KAElB,kBAACI,EAAaA,CAACL,WAAY,GAAIH,MAAO,kBAAmBV,KAAM,gBAChD9D,MAAO0B,EAAQsJ,SAASU,gBAAiB,EAAOhH,SA5C/C2B,IACpB0E,EAAgB,OACTrJ,GAAAA,CACHsJ,SAAU,OACHA,GAAAA,CACH,CAAC3E,EAAM8C,cAAcrF,MAAOuC,EAAM8C,cAAcC,Y,KAwClD1H,EAAQsJ,SAASU,eACf,kBAACpH,EAASA,CAACE,MAAO,UACPG,WAAY,GACZb,KAAM,SACN9D,MAA6B,QAAtBiL,EAAAA,aAAAA,EAAAA,EAAgBM,cAAhBN,IAAAA,EAAAA,EAA0B,GACjCvG,SAxCK2B,IACxB0E,EAAgB,OACTrJ,GAAAA,CACHuJ,eAAgB,OACTA,GAAAA,CACH,CAAC5E,EAAMoF,OAAO3H,MAAOuC,EAAMoF,OAAOzL,U,EAoCvByE,YAAayG,EAAiBK,OAAS,aAAe,gBACtD3G,MAAO,GACPb,KAAM,aAGpBoH,IAAaD,EAAiBK,QAC3B,kBAAC/B,EAAAA,gBAAeA,CAAC5E,MAAO,QACpB,kBAAC+G,EAAAA,MAAKA,CAACC,MAAO,qBAAsBC,SAAU,SAC1C,kBAACrD,EAAAA,cAAaA,KACV,kBAACvI,IAAAA,KAAE,kDACgD,kBAAC6I,KAAAA,MAAI,gGS3EjFgD,gBCMwB,EAAGpH,WAAUjD,QAAOwH,aAAY8C,iBACvD,MAAO7H,EAAe8H,IAAoBC,EAAAA,EAAAA,UAAyB,KAC5DC,EAAsBC,IAA2BF,EAAAA,EAAAA,WAAkB,GAEpEG,GAAS5G,EAAAA,EAAAA,UAAQ,KACnB,IAAIrE,EAAIM,EAKR,YAJyB/C,IAArByC,EAAEF,iBACFE,EAAI,KAAKA,EAAMgE,GACfT,EAASvD,IAENA,CAAC,GACT,CAACM,EAAOiD,KAEJnB,EAAW8I,IAAgBJ,EAAAA,EAAAA,UAAsB,KACjDK,EAAkBC,IAAuBN,EAAAA,EAAAA,WAAkB,IAE3DO,EAAsBC,IAA2BR,EAAAA,EAAAA,UAAuB,CAAEtJ,GAAI,EAAGmB,KAAM,GAAI4I,UAAW,IAEvGC,EChCwB,EAACC,EAAgBC,KAC/C,MAAMC,GAASC,EAAAA,EAAAA,UACf,OAAOrH,EAAAA,EAAAA,cAAY,UACQhH,IAAnBoO,EAAOE,SACPC,OAAOC,aAAaJ,EAAOE,SAE/BF,EAAOE,QAAUC,OAAOE,WAAWP,EAAIC,EAAM,GAC9C,CAACD,EAAIC,GAAO,EDyBSO,CAAmBnE,EAAY,MAEvDqC,EAAAA,EAAAA,YAAU,KACNS,EAAWzL,qBAAqBO,MAAKqD,IACjC,IAAImJ,EAA4CnJ,EAAcR,MAAK4J,GAAKA,EAAE3K,KAAOlB,EAAMR,sBAC/DvC,IAApB2O,GAA0D,IAAzBnJ,EAAcqJ,SAC/CF,EAAkB,CAAE1K,GAAI,EAAGmB,KAAM,6BAA8B4I,UAAW,SAEtDhO,IAApB2O,GAAiCnJ,EAAcqJ,OAAS,IACxDF,EAAkBnJ,EAAc,IAEpCuI,EAAwBY,GACxBrB,EAAiB9H,EAAc,IAChCsJ,SAAQ,KACPrB,GAAwB,EAAM,GAChC,GACH,KAEHb,EAAAA,EAAAA,YAAU,KAC0B,IAA5BkB,EAAqB7J,KAGzB4J,GAAoB,GACpBR,EAAW/K,eAAeyM,OAAOjB,EAAqB7J,KAAK9B,MAAK0C,IAC5D8I,EAAa9I,GACboJ,GAAiB,IAClBa,SAAQ,KACPjB,GAAoB,EAAM,IAC5B,GACH,CAACA,EAAqBC,EAAsBH,EAAcN,EAAYY,IAEzE,MAAMe,GAAehI,EAAAA,EAAAA,cAAaoC,IAC9BpD,EAAS,OAAK0H,GAAAA,CAAQlL,KAAM4G,KAC5B6E,GAAiB,GAClB,CAACjI,EAAU0H,EAAQO,KAEtBrB,EAAAA,EAAAA,YAAU,KAC0B,IAA5BkB,EAAqB7J,IACrB6J,EAAqB7J,KAAOyJ,EAAOnL,gBACnCyD,EAAS,OAAK0H,GAAAA,CAAQnL,eAAgBuL,EAAqB7J,KAC/D,GACD,CAAC6J,EAAsBJ,EAAQ1H,IAElC,MAAMsD,GAAQxC,EAAAA,EAAAA,UAAQ,KAClB,MAAMnD,EAAmC,CAAC,EAC1C,IAAK,MAAMmB,KAAQD,EAAW,MACN7E,IAAhB2D,EAAU,KACVA,EAAU,KAAI,CAACmB,EAAKO,OAEoB,IAApC1B,EAAU,KAAEsL,QAAQnK,EAAKO,OACzB1B,EAAU,KAAEuL,KAAKpK,EAAKO,MAG9B,IAAK,MAAMvB,KAAWgB,EAAKtC,UACFxC,IAAjB2D,EAAIG,KACJH,EAAIG,GAAW,KAE+B,IAA9CH,EAAIG,GAASmL,QAAQnK,EAAKtC,KAAKsB,KAC/BH,EAAIG,GAASoL,KAAKpK,EAAKtC,KAAKsB,GAGxC,CACA,OAAOH,CAAG,GACX,CAACkB,IAEEsK,EAA2B1D,IAC7BzF,EAAS,OAAK0H,GAAAA,CAAQtK,qBAAsBqI,I,EAGhD,OACI,kBAACpE,MAAAA,CAAIC,UAAW,yBACZ,kBAACf,EAAAA,eAAcA,UACsBvG,IAAhC0N,EAAOtK,qBACJ,kBAACsD,EAAoBA,CAACC,UAAW6G,GAAwBI,EACrDpI,cAAeA,EACfC,aAAcqI,EACdlH,YAAamH,IACjB,kBAACxC,EAAgBA,CAACjK,MAAOoM,EAAOtK,qBAAsBwD,YAAauI,IAEvE,kBAAC7I,EAAaA,CAACR,MAAO,gBAAiBV,KAAM,cACzC9D,WAAuCtB,IAAhC0N,EAAOtK,qBAAoC4C,SAAW2D,IACrDA,EAAEc,cAAcC,QAChByE,EAAwB,IAExBA,OAAwBnP,EAC5B,KAGZ,kBAAC4L,EAAmBA,CAChB7I,MAAOA,EACPiD,SAAUA,EACVuE,WAAYA,IAEhB,kBAACpB,EAAUA,CAACC,QAASsE,EAAOlL,MAAQ,GAChCsF,SAAUkH,EACV1F,MAAOA,IAEX,kBAACgB,EAAaA,CAACvH,MAAOA,EAAOiD,SAAUA,EAAUuE,WAAY0D,I,IDxHtEmB,wBDQ2B,EAAErM,QAAOiD,eAEnC,MAAMvD,GAAIqE,EAAAA,EAAAA,UAAQ,SACU9G,IAApB+C,EAAMwC,WAA+C,KAApBxC,EAAMwC,UAChC,OAAIxC,GAAAA,CAAOwC,UAAW,OAAQhD,eAAgB,IAAKC,KAAM,GAAIsB,QAAS,KAE1Ef,GACR,CAACA,IAMEsM,EAAgB1H,IAClB3B,EAAS,OAAIvD,GAAAA,CAAG,CAACkF,EAAMoF,OAAO3H,MAAOuC,EAAMoF,OAAOzL,Q,MAgCgDyB,EAMhEA,EAGsDA,EAGvDN,EA9BrC,OACI,kBAACqH,EAAAA,cAAaA,CAACa,QAAS,MACpB,kBAACG,EAAAA,gBAAeA,CAACH,QAAS,MACtB,kBAACpE,EAAAA,eAAcA,KACX,kBAACJ,EAAAA,YAAWA,CAACL,MAAO,aAAcG,WAN/B,IAOC,kBAACqJ,EAAAA,iBAAgBA,CAACtM,QAZb,CACrB,CAAC8C,MAAO,cAAexE,MAAO,QAC9B,CAACwE,MAAO,gBAAiBxE,MAAO,iBAU6BA,MAAOmB,EAAE8C,UAAWS,SAAWuJ,IACxEvJ,EAAS,OAAIvD,GAAAA,CAAG8C,UAAWgK,QAAAA,EAAK,S,OAK/B,SAAhB9M,EAAE8C,WACC,kBAACuE,EAAAA,cAAaA,KACV,kBAACgB,EAAAA,gBAAeA,KACZ,kBAAClF,EAASA,CAACE,MAAO,kBAAmBC,YAAa,KACvCzE,WAA4BtB,IAArByC,EAAEF,eAA+B,IAAME,EAAEF,eAAeiN,WAC/DpK,KAAM,iBACNY,SAAUqJ,EAAcpJ,WAnBpC,KAoBC,kBAACL,EAASA,CAACE,MAAO,WAAYC,YAAa,OAAQE,WApBpD,GAoB4E3E,MAAoB,QAAbyB,EAAAA,EAAMe,eAANf,IAAAA,EAAAA,EAAiB,GACxFqC,KAAM,UACNY,SAAUqJ,KAEzB,kBAACvE,EAAAA,gBAAeA,KACZ,kBAAClF,EAASA,CAACE,MAAO,qBAAsBC,YAAa,MAAOE,WAzB7D,GA0BY3E,MAAwB,QAAjByB,EAAAA,EAAMoC,mBAANpC,IAAAA,EAAAA,EAAqB,GAC5BqC,KAAM,cACNY,SAAUqJ,IACrB,kBAAC/I,EAAaA,CAACR,MAAO,mBAAoBV,KAAM,gBAAiB9D,MAA0B,QAAnByB,EAAAA,EAAM0B,qBAAN1B,IAAAA,GAAAA,EACzDiD,SAvCX2B,IACpB3B,EAAS,OAAIvD,GAAAA,CAAG,CAACkF,EAAM8C,cAAcrF,MAAOuC,EAAM8C,cAAcC,U,KAwCpD,kBAACvB,EAAUA,CAACC,QAAe,QAAN3G,EAAAA,EAAED,YAAFC,IAAAA,EAAAA,EAAU,GAAIqF,SAjD/BtF,IAChBwD,EAAS,OAAIvD,GAAAA,CAAGD,KAAMA,I","sources":["webpack://iotopen-datasource/external amd \"@grafana/data\"","webpack://iotopen-datasource/external amd \"@grafana/runtime\"","webpack://iotopen-datasource/external amd \"@grafana/ui\"","webpack://iotopen-datasource/external amd \"lodash\"","webpack://iotopen-datasource/external amd \"module\"","webpack://iotopen-datasource/external amd \"react\"","webpack://iotopen-datasource/webpack/bootstrap","webpack://iotopen-datasource/webpack/runtime/compat get default export","webpack://iotopen-datasource/webpack/runtime/define property getters","webpack://iotopen-datasource/webpack/runtime/hasOwnProperty shorthand","webpack://iotopen-datasource/webpack/runtime/make namespace object","webpack://iotopen-datasource/webpack/runtime/publicPath","webpack://iotopen-datasource/./node_modules/grafana-public-path.js","webpack://iotopen-datasource/./DataSource.ts","webpack://iotopen-datasource/./components/form/FormField.tsx","webpack://iotopen-datasource/./components/form/LabeledSwitch.tsx","webpack://iotopen-datasource/./ConfigEditor.tsx","webpack://iotopen-datasource/./types.ts","webpack://iotopen-datasource/./components/InstallationSelector.tsx","webpack://iotopen-datasource/./components/FilterEntry.tsx","webpack://iotopen-datasource/./components/MetaEditor.tsx","webpack://iotopen-datasource/./components/TweakSettings.tsx","webpack://iotopen-datasource/./components/VariableSelector.tsx","webpack://iotopen-datasource/./components/AggregationSettings.tsx","webpack://iotopen-datasource/./VariableEditor.tsx","webpack://iotopen-datasource/./module.ts","webpack://iotopen-datasource/./QueryEditor.tsx","webpack://iotopen-datasource/./components/useBackoffCallback.tsx"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__781__;","module.exports = __WEBPACK_EXTERNAL_MODULE__531__;","module.exports = __WEBPACK_EXTERNAL_MODULE__7__;","module.exports = __WEBPACK_EXTERNAL_MODULE__241__;","module.exports = __WEBPACK_EXTERNAL_MODULE__308__;","module.exports = __WEBPACK_EXTERNAL_MODULE__959__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"public/plugins/iotopen-datasource/\";","\nimport amdMetaModule from 'amd-module';\n\n__webpack_public_path__ =\n  amdMetaModule && amdMetaModule.uri\n    ? amdMetaModule.uri.slice(0, amdMetaModule.uri.lastIndexOf('/') + 1)\n    : 'public/plugins/iotopen-datasource/';\n","import {DataQueryRequest, DataQueryResponse, DataSourceInstanceSettings, MetricFindValue} from '@grafana/data';\nimport {DataSourceWithBackend, getBackendSrv, getTemplateSrv} from '@grafana/runtime';\nimport {DeviceX, FunctionX, Installation, Meta, MyDataSourceOptions, MyQuery, MyVariableQuery} from './types';\nimport {Observable} from 'rxjs';\nimport {toNumber} from \"lodash\";\n\nexport class DataSource extends DataSourceWithBackend<MyQuery, MyDataSourceOptions> {\n    private settings: DataSourceInstanceSettings<MyDataSourceOptions>;\n\n    constructor(instanceSettings: DataSourceInstanceSettings<MyDataSourceOptions>) {\n        super(instanceSettings);\n        this.settings = instanceSettings;\n    }\n\n    fetchInstallations(): Promise<Installation[]> {\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/installationinfo`,\n            })\n            .then(result => result.data);\n    }\n\n    fetchFunctions(installationId: number, meta?: { [key: string]: string }): Promise<FunctionX[]> {\n        const q = meta ? Object.keys(meta).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(meta[key])}`).join('&') : '';\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/functionx/${installationId}?${q}`,\n            })\n            .then(result => result.data as FunctionX[]);\n    }\n\n    fetchDevices(installationId: number, meta?: { [key: string]: string }): Promise<DeviceX[]> {\n        const q = meta ? Object.keys(meta).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(meta[key])}`).join('&') : '';\n        return getBackendSrv()\n            .datasourceRequest({\n                method: 'GET',\n                url: `${this.settings.url}/api/v2/devicex/${installationId}?${q}`,\n            })\n            .then(result => result.data as DeviceX[]);\n    }\n\n    query(options: DataQueryRequest<MyQuery>): Observable<DataQueryResponse> {\n        const templateSrv = getTemplateSrv();\n        const targets = options.targets.map(value => {\n            return {\n                ...value, installationId: value.installationVariable ? toNumber(templateSrv.replace(value.installationVariable)) : value.installationId,\n                meta: value.meta.map(meta => {\n                    return {\n                        key: templateSrv.replace(meta.key),\n                        value: templateSrv.replace(meta.value),\n                    }\n                }, value)\n            }\n        });\n        return super.query({...options, targets});\n    }\n\n    joinMeta(deviceMeta: DeviceX, functionMeta: FunctionX): Meta {\n        const res: Meta = {};\n        Object.keys(functionMeta.meta).forEach(key => {\n            res[key] = functionMeta.meta[key];\n        });\n        if(deviceMeta !== undefined && deviceMeta !== null) {\n            Object.keys(deviceMeta.meta).forEach(key => {\n                res[`@device.${key}`] = deviceMeta.meta[key];\n            });\n        }\n        return res;\n    }\n\n    findMetaQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        if (query.metaKey === '' || query.installationId === '0' || query.installationId === '') {\n            return Promise.resolve([]);\n        }\n        let id = toNumber(query.installationId);\n        if (typeof query.installationId === 'string' && query.installationId.includes('$')) {\n            const tmp = getTemplateSrv().replace(query.installationId);\n            id = toNumber(tmp);\n        }\n        if (isNaN(id)) {\n            return Promise.reject(`Invalid installation id: ${query.installationId} => ${id}`);\n        }\n        const filter = query.meta ? query.meta.reduce<{ [key: string]: string }>((acc, meta) => {\n            if (meta.key !== '' && meta.value !== '') {\n                acc[meta.key] = meta.value;\n            }\n            return acc;\n        }, {}) : {};\n        if(query.addDeviceMeta) {\n            return this.fetchDevices(id).then(devices => {\n                const deviceMap: {[key: string]: DeviceX} = devices.reduce<{ [key: string]: DeviceX }>((acc, device) => {\n                    acc[`${device.id}`] = device;\n                    return acc;\n                }, {});\n                return this.fetchFunctions(id, filter).then(functions => {\n                    return functions.reduce<MetricFindValue[]>((acc, func) => {\n                        const dev = deviceMap[func.meta['device_id']];\n                        const meta = this.joinMeta(dev,func);\n                        if (!acc.find(f => f.text === meta[query.metaKey]) && meta[query.metaKey]) {\n                            if(query.metaNameKey !== \"\" && meta[query.metaNameKey]) {\n                                const name = query.metaNameKey === 'type' ? func.type : meta[query.metaNameKey];\n                                return [...acc, {text: name, value: meta[query.metaKey]}];\n                            } else {\n                                return [...acc, {text: meta[`${query.metaKey}`], value: meta[query.metaKey]}];\n                            }\n                        }\n                        return acc;\n                    }, []);\n                }).then(result => {\n                    return result;\n                })\n            }).then(result => {\n                return result;\n            });\n        }\n        return this.fetchFunctions(id, filter).then(functions => {\n            return functions.reduce<MetricFindValue[]>((acc, func) => {\n                if (!acc.find(f => f.text === func.meta[query.metaKey]) && func.meta[query.metaKey]) {\n                    if(query.metaNameKey !== \"\" && func.meta[query.metaNameKey]) {\n                        const name = query.metaNameKey === 'type' ? func.type : func.meta[query.metaNameKey];\n                        return [...acc, {text: name, value: func.meta[query.metaKey]}];\n                    } else {\n                        return [...acc, {text: func.meta[query.metaKey], value: func.meta[query.metaKey]}];\n                    }\n                }\n                return acc;\n            }, []);\n        }).then(result => {\n            return result;\n        })\n    }\n\n    metricFindQuery(query: MyVariableQuery, options?: any): Promise<MetricFindValue[]> {\n        const qt = query.queryMode ? query.queryMode : 'functionMeta';\n        switch (qt) {\n            case 'installation':\n                return this.fetchInstallations().then(installations => {\n                    return installations.reduce<MetricFindValue[]>((acc, installation) => {\n                        return [...acc, {text: installation.name, value: installation.id}];\n                    }, []);\n                });\n            case 'functionMeta':\n                return this.findMetaQuery(query, options);\n            default:\n                return this.findMetaQuery(query, options);\n\n        }\n    }\n}\n","import React, {FormEventHandler, ReactElement} from 'react';\nimport {InlineField, Input} from \"@grafana/ui\";\n\nexport interface FormFieldProps {\n    label: string;\n    placeholder: string;\n    value: string;\n    name: string;\n    onChange: FormEventHandler<HTMLInputElement>;\n    tooltip?: ReactElement;\n    labelWidth?: number | \"auto\";\n    width?: number;\n    type?: string;\n}\n\nexport const FormField = ({type, tooltip, label, placeholder, name, value, onChange, labelWidth = 'auto', width}: FormFieldProps) => {\n    return(\n        <InlineField label={label} labelWidth={labelWidth} tooltip={tooltip} grow={true}>\n            <Input type={type} name={name} placeholder={placeholder} value={value} onChange={onChange}  width={width}/>\n        </InlineField>\n    )\n}\n","import React, {FormEventHandler} from \"react\";\nimport {InlineField, InlineFieldRow, InlineSwitch} from \"@grafana/ui\";\n\nexport interface LabeledSwitchProps {\n    label: string;\n    name: string;\n    value: boolean;\n    labelWidth?: number | \"auto\";\n    onChange: FormEventHandler<HTMLInputElement>;\n}\n\nexport const LabeledSwitch = ({label, value, name, onChange, labelWidth = 'auto'}: LabeledSwitchProps) => {\n    return (\n        <InlineFieldRow>\n            <InlineField label={label} labelWidth={labelWidth} >\n                <InlineSwitch value={value} name={name} onChange={onChange}/>\n            </InlineField>\n        </InlineFieldRow>\n    )\n}\n","import React, {ChangeEvent, SyntheticEvent, useEffect} from 'react';\nimport {MyDataSourceOptions, MySecureJsonData} from './types';\nimport {DataSourcePluginOptionsEditorProps} from '@grafana/data';\nimport {Alert, HorizontalGroup, VerticalGroup} from '@grafana/ui';\nimport {FormField} from 'components/form/FormField'\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\n\ninterface ConfigEditorProps extends DataSourcePluginOptionsEditorProps<MyDataSourceOptions, MySecureJsonData> {\n}\n\nexport const ConfigEditor = ({onOptionsChange, options}: ConfigEditorProps) => {\n    const {jsonData, secureJsonData, secureJsonFields} = options;\n    const [migrated, setMigrated] = React.useState(false);\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    const onChangeSwitch = (event: SyntheticEvent<HTMLInputElement, Event>) => {\n        onOptionsChange({\n            ...options,\n            jsonData: {\n                ...jsonData,\n                [event.currentTarget.name]: event.currentTarget.checked\n            }\n        });\n    }\n\n    const onChangeSecretText = (event: ChangeEvent<HTMLInputElement>) => {\n        onOptionsChange({\n            ...options,\n            secureJsonData: {\n                ...secureJsonData,\n                [event.target.name]: event.target.value\n            }\n        });\n    }\n\n    useEffect(() => {\n        if (options.jsonData.apiKey !== undefined && options.jsonData.apiKey !== '') {\n            setMigrated(true);\n            let newJsonData = {...jsonData};\n            delete newJsonData.apiKey;\n            onOptionsChange({\n                ...options,\n                secureJsonData: {...secureJsonData, apiKey: options.jsonData.apiKey},\n                jsonData: newJsonData\n            });\n        }\n    }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n    return (\n        <VerticalGroup spacing={\"none\"}>\n            <FormField label={\"URL\"}\n                       value={options.jsonData.url || ''}\n                       name={\"url\"}\n                       placeholder={\"Enter URL, eg. https://lynx.iotopen.se\"}\n                       onChange={onChangeText}\n                       labelWidth={15}\n                       width={40}\n            />\n            <LabeledSwitch labelWidth={15} label={\"OAuth2 Passthru\"} name={\"oauthPassThru\"}\n                           value={options.jsonData.oauthPassThru || false} onChange={onChangeSwitch}/>\n            {!options.jsonData.oauthPassThru &&\n                <FormField label={\"API Key\"}\n                           labelWidth={15}\n                           name={\"apiKey\"}\n                           value={secureJsonData?.apiKey ?? ''}\n                           onChange={onChangeSecretText}\n                           placeholder={secureJsonFields.apiKey ? 'Configured' : 'Enter API Key'}\n                           width={70}\n                           type={\"password\"}\n                />\n            }\n            {migrated && !secureJsonFields.apiKey &&\n                <HorizontalGroup width={\"100%\"}>\n                    <Alert title={\"Secure the API Key\"} severity={\"error\"}>\n                        <VerticalGroup>\n                            <p>\n                                The API key has migrated to a secure location. <br/>\n                                Please press save to migrate the key to the secure store and get rid of this message.\n                            </p>\n                        </VerticalGroup>\n                    </Alert>\n                </HorizontalGroup>}\n        </VerticalGroup>\n    )\n}\n","import { DataQuery, DataSourceJsonData } from '@grafana/data';\n\n\nexport interface MetaEntry {\n    key: string;\n    value: string;\n}\n\nexport interface MyVariableQuery {\n    queryMode: string;\n    installationId: string | number;\n    meta: MetaEntry[];\n    metaKey: string;\n    metaNameKey: string;\n    addDeviceMeta: boolean;\n}\n\nexport interface MyQuery extends DataQuery {\n    installationId: number;\n    installationVariable?: string;\n    type: string;\n    meta: MetaEntry[];\n    tabledata: boolean;\n    stateOnly: boolean;\n    metaAsFields: boolean;\n    joinDeviceMeta: boolean;\n    linkKey: string;\n    messageFrom: string;\n    groupBy: string;\n    nameBy: string;\n    metaAsLabels: boolean;\n    aggrMethod?: string;\n    aggrInterval?: string;\n}\n\n\nexport const defaultQuery: Partial<MyQuery> = {\n    installationId: 0,\n    type: '',\n    meta: [{ key: 'type', value: '' }],\n};\n\n\nexport type Meta = { [index: string]: string };\n\nexport interface FunctionX {\n    id: number;\n    type: string;\n    meta: Meta;\n}\n\nexport interface DeviceX {\n    id: number;\n    type: string;\n    meta: Meta;\n}\n\nexport interface Installation {\n    id: number;\n    client_id: number;\n    name: string;\n}\n\n/**\n * These are options configured for each DataSource instance\n */\nexport interface MyDataSourceOptions extends DataSourceJsonData {\n    url?: string;\n    apiKey?: string;\n    oauthPassThru?: boolean;\n    auth?: string;\n}\n\nexport interface MySecureJsonData {\n    apiKey?: string;\n}\n","import { Installation } from \"../types\";\nimport { Select } from \"@grafana/ui\";\nimport React, { useCallback, useMemo } from \"react\";\nimport { SelectableValue } from \"@grafana/data\";\nimport { SelectValue } from \"@grafana/ui/components/Select/types\";\n\n\nexport interface InstallationSelectorProps {\n    isLoading: boolean;\n    installations: Installation[];\n    installation: Installation;\n    onSelection (installation: Installation): void;\n}\n\nexport const InstallationSelector = ({\n    isLoading,\n    installations,\n    installation,\n    onSelection\n}: InstallationSelectorProps) => {\n    const installationOptions = useMemo<Array<SelectValue<Installation>>>(() => {\n        return installations.map((installation) => {\n            return { label: installation.name, value: installation };\n        });\n    }, [installations]);\n\n    const currentSelectedInstallation = useMemo<SelectValue<Installation>>(() => {\n        return { label: installation.name, value: installation };\n    }, [installation]);\n\n    const onChange = (event: SelectableValue<Installation>) => {\n        onSelection(event.value ?? installations[0]);\n    }\n\n    const filter = useCallback((option: SelectableValue<Installation>, rawInput: string) => {\n        const input = rawInput.toLowerCase();\n        return option.value?.name?.toLowerCase().includes(input) ?? false;\n    }, []);\n\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                isLoading={isLoading}\n                placeholder={\"Installation\"}\n                noOptionsMessage={\"No available installations\"}\n                filterOption={filter}\n                width={65}\n                options={installationOptions}\n                menuPlacement={'bottom'}\n                onChange={onChange}\n                value={currentSelectedInstallation}\n            />\n        </div>\n    )\n};\n","import React, { MouseEventHandler, useCallback, useMemo } from 'react';\nimport { Button, Select } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { MetaEntry } from \"../types\";\n\ntype onDeleteFunction = () => void;\ntype onUpdateFunction = (event: MetaEntry) => void;\n\ninterface FilterEntryProps {\n  data: MetaEntry;\n  onDelete: onDeleteFunction;\n  onUpdate: onUpdateFunction;\n  keys?: string[];\n  values?: string[];\n}\n\n\nexport const FilterEntry = ({ data, keys, values, onUpdate, onDelete }: FilterEntryProps) => {\n  const selectableKeys = useMemo<SelectableValue[]>(() => {\n    if (keys) {\n      return keys.map((value) => ({ label: value, value: value }))\n    }\n    return []\n  }, [keys]);\n  const selectableValues = useMemo<SelectableValue[]>(() => {\n    if (values) {\n      return values.map((value) => ({ label: value, value: value }))\n    }\n    return []\n  }, [values]);\n\n  const currentKey = useMemo<SelectableValue>(() => {\n    return { label: data.key, value: data.key }\n  }, [data]);\n\n  const currentValue = useMemo<SelectableValue>(() => {\n    return { label: data.value, value: data.value }\n  }, [data]);\n\n  const onChangeKey = useCallback((event: SelectableValue) => {\n    onUpdate({ ...data, key: event.value });\n  }, [data, onUpdate]);\n\n  const onChangeValue = useCallback((event: SelectableValue) => {\n    onUpdate({ ...data, value: event.value });\n  }, [data, onUpdate]);\n\n  const onCreateKey = useCallback((newValue: string) => {\n    onUpdate({ ...data, key: newValue })\n  }, [data, onUpdate]);\n\n  const onCreateValue = useCallback((newValue: string) => {\n    onUpdate({ ...data, value: newValue })\n  }, [data, onUpdate]);\n\n  const deleteEventHandler = useCallback<MouseEventHandler<HTMLButtonElement>>((event) => {\n    event.preventDefault();\n    onDelete();\n  }, [onDelete]);\n\n  return (\n    <div className={'gf-form-inline'}>\n      <div className={'gf-form'}>\n        <span className={'gf-form-label query-keyword'}>key</span>\n        <Select\n          width={30}\n          options={selectableKeys}\n          onChange={onChangeKey}\n          onCreateOption={onCreateKey}\n          value={currentKey}\n          isSearchable={true}\n          allowCustomValue={true}\n          menuPlacement={'bottom'}\n          placeholder={'meta key'}\n        />\n        <span className={'gf-form-label query-keyword'}>match</span>\n        <Select\n          width={30}\n          options={selectableValues}\n          onChange={onChangeValue}\n          onCreateOption={onCreateValue}\n          value={currentValue}\n          isSearchable={true}\n          allowCustomValue={true}\n          menuPlacement={'bottom'}\n          placeholder={'wildcard match'}\n        />\n        <Button variant={'destructive'} onClick={deleteEventHandler} icon={'trash-alt'} />\n      </div>\n    </div>\n  )\n};\n","import {MetaEntry} from \"../types\";\nimport {FilterEntry} from \"./FilterEntry\";\nimport React, {MouseEvent, useCallback} from \"react\";\nimport {Button, VerticalGroup} from \"@grafana/ui\";\n\n\nexport interface MetaEditorProps {\n    entries: MetaEntry[];\n    onUpdate(entries: MetaEntry[]): void;\n    hints?: {[key: string]: string[]};\n}\n\nexport const MetaEditor = ({entries: ents, onUpdate, hints}: MetaEditorProps) => {\n\n    const onMetaDelete = useCallback((idx: number) => {\n        const tmp = ents.filter((value, index) => index !== idx);\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    const onMetaAdd = useCallback((e: MouseEvent) => {\n        onUpdate([...ents, {key: '', value: ''}]);\n        e.preventDefault();\n    }, [ents, onUpdate]);\n\n    const onMetaUpdate = useCallback((idx: number, value: MetaEntry) => {\n        const tmp = ents.map((entry, index) => {\n            if (index === idx) {\n                return value;\n            }\n            return entry;\n        });\n        onUpdate(tmp);\n    }, [ents, onUpdate]);\n\n    return (\n        <VerticalGroup>\n            <div className={'gf-form-inline,ui-list'}>\n                {ents.map((value, idx) => {\n                    return (\n                        <FilterEntry\n                            key={idx}\n                            data={value}\n                            onDelete={() => {onMetaDelete(idx)}}\n                            onUpdate={(value) => onMetaUpdate(idx, value)}\n                            keys={hints ? Object.keys(hints):[]}\n                            values={hints ? hints[value.key] ?? []:[]}\n                        />\n                    );\n                })}\n            </div>\n            <div className={'gf-form-inline'} style={{paddingBottom: 10}}>\n                <Button onClick={onMetaAdd} icon={'plus'}>Add filter</Button>\n            </div>\n        </VerticalGroup>\n    )\n};\n","import { MyQuery } from \"../types\";\nimport {\n    VerticalGroup,\n    HorizontalGroup,\n} from \"@grafana/ui\";\nimport React, { FormEvent } from \"react\";\nimport { LabeledSwitch } from \"./form/LabeledSwitch\";\nimport { FormField } from \"./form/FormField\";\n\nexport interface TweakSettingsProps {\n    query: MyQuery;\n\n    onChange (query: MyQuery): void;\n\n    onRunQuery (): void;\n}\n\nconst tooltipGroupBy = (\n    <>\n        Group series by some meta key or payload <code>msg</code> field. Defaults to Function ID.\n    </>\n);\nconst tooltipNameBy = (\n    <>\n        This will name series based on some meta key.\n        <br />\n        Defaults to <code>name</code>.\n    </>\n);\nconst tooltipMessageFrom = (\n    <>\n        Using this field will join matching functions with the same filter, but the type changed to this field. The\n        msg\n        field will be overwritten by messages matching this type, linked through <code>device_id</code> meta key.\n        Useful\n        for eg. joining positional data. <br />\n        This field is only applied on table data.\n    </>\n);\n\nexport const TweakSettings = ({ query, onChange, onRunQuery }: TweakSettingsProps) => {\n\n    const onGroupByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, groupBy: event.currentTarget.value });\n        onRunQuery();\n    }\n\n    const onNameByChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, nameBy: event.currentTarget.value });\n        onRunQuery();\n    }\n\n    const onMessageChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, messageFrom: event.currentTarget.value });\n        onRunQuery();\n    }\n\n    const onLinkChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, linkKey: event.currentTarget.value });\n        onRunQuery();\n    }\n    const onSwitchChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, [event.currentTarget.name]: event.currentTarget.checked });\n        onRunQuery();\n    }\n    const onMetaAsLabelsChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, [event.currentTarget.name]: event.currentTarget.checked });\n        onRunQuery();\n    }\n\n    return (\n        <>\n            <VerticalGroup spacing={\"xs\"}>\n                <FormField\n                    name={'groupBy'}\n                    labelWidth={16}\n                    label={'Group by'}\n                    onChange={onGroupByChange}\n                    value={query.groupBy}\n                    placeholder={'Function ID'}\n                    tooltip={tooltipGroupBy}\n                />\n                <FormField\n                    name={'nameBy'}\n                    labelWidth={16}\n                    label={'Name by'}\n                    placeholder={'name'}\n                    onChange={onNameByChange}\n                    value={query.nameBy}\n                    tooltip={tooltipNameBy}\n                />\n                <HorizontalGroup align={\"flex-start\"} spacing={\"xs\"}>\n                    <LabeledSwitch label={\"As table data\"} value={query.tabledata} name={\"tabledata\"}\n                        onChange={onSwitchChange} labelWidth={16} />\n                    {query.tabledata && <VerticalGroup spacing={\"xs\"} align={\"flex-start\"}>\n                        <FormField\n                            placeholder={'eg. latitude'}\n                            name={'messageFrom'}\n                            labelWidth={20}\n                            label={'Message from'}\n                            onChange={onMessageChange}\n                            value={query.messageFrom}\n                            tooltip={tooltipMessageFrom}\n                        />\n                        <FormField labelWidth={20} placeholder={'device_id'} name={'linkKey'} label={'Linked with'} onChange={onLinkChange}\n                            value={query.linkKey} />\n                        <LabeledSwitch label={\"Meta as fields\"} labelWidth={20} value={query.metaAsFields} name={\"metaAsFields\"}\n                            onChange={onSwitchChange} />\n                        {query.metaAsFields && <LabeledSwitch label={\"Add device meta\"} labelWidth={20} name={\"joinDeviceMeta\"}\n                            value={query.joinDeviceMeta} onChange={onSwitchChange} />}\n                    </VerticalGroup>\n                    }\n                </HorizontalGroup>\n\n                <LabeledSwitch label={\"Current state only\"} value={query.stateOnly} name={\"stateOnly\"}\n                    onChange={onSwitchChange} labelWidth={16} />\n                <LabeledSwitch label={\"Meta as labels\"} name={\"metaAsLabels\"} value={query.metaAsLabels}\n                    onChange={onMetaAsLabelsChange} labelWidth={16} />\n            </VerticalGroup>\n        </>\n    )\n}\n","import {getTemplateSrv} from \"@grafana/runtime\";\nimport {Select} from \"@grafana/ui\";\nimport React from \"react\";\n\n\ntype VariableSelectorProps = {\n    value: string;\n    onSelection: (selection: string) => void;\n}\n\nexport const VariableSelector = ({value, onSelection}: VariableSelectorProps) => {\n    const templateSrv = getTemplateSrv();\n    const variables = templateSrv.getVariables();\n    const options = variables.map((variable) => {\n        return {label: variable.name, value: `$\\{${variable.name}}`};\n    });\n    return (\n        <div className={'gf-form-inline'}>\n            <Select\n                placeholder={\"Variable\"}\n                noOptionsMessage={\"No available variables\"}\n                width={65}\n                options={options}\n                menuPlacement={'bottom'}\n                onChange={(event) => onSelection(event.value ?? '')}\n                value={value}\n            />\n        </div>\n    )\n}\n","import React, { FormEvent } from 'react';\nimport { HorizontalGroup, Select } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { FormField } from './form/FormField';\nimport { MyQuery } from '../types';\n\ninterface AggregationSettingsProps {\n    query: MyQuery;\n    onChange: (query: MyQuery) => void;\n    onRunQuery: () => void;\n}\n\nconst aggregationMethods: Array<SelectableValue<string>> = [\n    { label: 'Average', value: 'avg' },\n    { label: 'Count', value: 'count' },\n    { label: 'First', value: 'first' },\n    { label: 'Last', value: 'last' },\n    { label: 'Max', value: 'max' },\n    { label: 'Median', value: 'median' },\n    { label: 'Min', value: 'min' },\n    { label: 'Percentile 50', value: 'percentile(50)' },\n    { label: 'Percentile 90', value: 'percentile(90)' },\n    { label: 'Percentile 95', value: 'percentile(95)' },\n    { label: 'Percentile 99', value: 'percentile(99)' },\n    { label: 'Spread', value: 'spread' },\n    { label: 'Standard Deviation', value: 'stddev' },\n    { label: 'Sum', value: 'sum' },\n];\n\nconst tooltipAggrInterval = (\n    <>\n        <p>\n            Time interval for data aggregation. Format: 1m, 10m, 2h, 24h\n            <br />\n            If a method is chosen but no interval is specified, the default interval will be 1m.\n        </p>\n    </>\n);\n\nexport const AggregationSettings: React.FC<AggregationSettingsProps> = ({ query, onChange, onRunQuery }) => {\n    const onAggrMethodChange = (value: SelectableValue<string> | null) => {\n        onChange({\n            ...query,\n            aggrMethod: value?.value || '',\n            aggrInterval: value?.value ? query.aggrInterval : ''\n        });\n        onRunQuery();\n    };\n\n    const onAggrIntervalChange = (event: FormEvent<HTMLInputElement>) => {\n        onChange({ ...query, aggrInterval: event.currentTarget.value });\n        onRunQuery();\n    };\n\n    return (\n        <>\n            <div style={{ marginBottom: '16px' }}>\n                <HorizontalGroup align={\"flex-start\"} spacing={\"xs\"}>\n                    <label className=\"gf-form-label label\">Aggregation method</label>\n                    <div>\n                        <Select\n                            width={22}\n                            options={aggregationMethods}\n                            value={query.aggrMethod ? aggregationMethods.find(x => x.value === query.aggrMethod) : undefined}\n                            onChange={onAggrMethodChange}\n                            isClearable={true}\n                        />\n                    </div>\n                    <div>\n                        <FormField\n                            name={'aggrInterval'}\n                            label={'Interval'}\n                            tooltip={tooltipAggrInterval}\n                            width={13}\n                            value={query.aggrInterval ?? ''}\n                            onChange={onAggrIntervalChange}\n                            placeholder={'None'}\n                        />\n                    </div>\n                </HorizontalGroup>\n            </div>\n        </>\n    );\n};","import React, {ChangeEvent, SyntheticEvent, useMemo} from \"react\";\nimport {MetaEntry, MyVariableQuery} from \"./types\";\nimport {\n    HorizontalGroup,\n    InlineField,\n    InlineFieldRow,\n    RadioButtonGroup,\n    VerticalGroup\n} from \"@grafana/ui\";\nimport {FormField} from \"./components/form/FormField\";\nimport {MetaEditor} from \"./components/MetaEditor\";\nimport {LabeledSwitch} from \"./components/form/LabeledSwitch\";\n\nexport interface MyVariableEditorProps {\n    query: MyVariableQuery;\n    onChange: (query: MyVariableQuery) => void;\n}\n\nexport const VariableEditor = ({query, onChange}: MyVariableEditorProps) => {\n\n    const q = useMemo(() => {\n        if (query.queryMode === undefined || query.queryMode === '') {\n            return {...query, queryMode: 'meta', installationId: '0', meta: [], metaKey: ''};\n        }\n        return query;\n    }, [query]);\n\n    const updateMeta = (meta: MetaEntry[]) => {\n        onChange({...q, meta: meta});\n    }\n\n    const onChangeText = (event: ChangeEvent<HTMLInputElement>) => {\n        onChange({...q, [event.target.name]: event.target.value});\n    }\n\n    const onChangeSwitch = (event: SyntheticEvent<HTMLInputElement, Event>) => {\n        onChange({...q, [event.currentTarget.name]: event.currentTarget.checked});\n    }\n\n    const queryModeOptions = [\n        {label: 'Meta values', value: 'meta'},\n        {label: 'Installations', value: 'installation'},\n    ];\n\n    const labelWidth = 17;\n\n    return (\n        <VerticalGroup spacing={\"xs\"}>\n            <HorizontalGroup spacing={\"xs\"}>\n                <InlineFieldRow>\n                    <InlineField label={\"Query mode\"} labelWidth={labelWidth}>\n                        <RadioButtonGroup options={queryModeOptions} value={q.queryMode} onChange={(v) => {\n                            onChange({...q, queryMode: v ?? 'meta'});\n                        }}/>\n                    </InlineField>\n                </InlineFieldRow>\n            </HorizontalGroup>\n            {q.queryMode === 'meta' &&\n                <VerticalGroup>\n                    <HorizontalGroup>\n                        <FormField label={\"Installation ID\"} placeholder={\"ID\"}\n                                   value={q.installationId === undefined ? '0' : q.installationId.toString()}\n                                   name={\"installationId\"}\n                                   onChange={onChangeText} labelWidth={labelWidth}/>\n                        <FormField label={\"Meta key\"} placeholder={\"name\"} labelWidth={labelWidth} value={query.metaKey ?? ''}\n                                   name={\"metaKey\"}\n                                   onChange={onChangeText}/>\n                    </HorizontalGroup>\n                    <HorizontalGroup>\n                        <FormField label={\"Name by meta value\"} placeholder={\"key\"} labelWidth={labelWidth}\n                                   value={query.metaNameKey ?? ''}\n                                   name={\"metaNameKey\"}\n                                   onChange={onChangeText}/>\n                        <LabeledSwitch label={\"Join device meta\"} name={\"addDeviceMeta\"} value={query.addDeviceMeta ?? false}\n                                       onChange={onChangeSwitch} />\n                    </HorizontalGroup>\n                    <MetaEditor entries={q.meta ?? []} onUpdate={updateMeta}/>\n                </VerticalGroup>\n            }\n        </VerticalGroup>\n    )\n}\n","import { DataSource } from './DataSource';\nimport { ConfigEditor } from './ConfigEditor';\nimport { QueryEditor } from './QueryEditor';\nimport { MyQuery, MyDataSourceOptions } from './types';\nimport { DataSourcePlugin } from '@grafana/data';\nimport {VariableEditor} from \"./VariableEditor\";\n\nexport const plugin = new DataSourcePlugin<DataSource, MyQuery, MyDataSourceOptions>(DataSource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryEditor(QueryEditor)\n  .setVariableQueryEditor(VariableEditor);\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { DataSource } from './DataSource';\nimport { MyQuery, MyDataSourceOptions, Installation, FunctionX, MetaEntry, defaultQuery } from './types';\nimport { QueryEditorProps } from '@grafana/data';\nimport { InstallationSelector } from \"./components/InstallationSelector\";\nimport { MetaEditor } from \"./components/MetaEditor\";\nimport { TweakSettings } from \"./components/TweakSettings\";\nimport { useBackoffCallback } from \"./components/useBackoffCallback\";\nimport { LabeledSwitch } from \"./components/form/LabeledSwitch\";\nimport { InlineFieldRow } from \"@grafana/ui\";\nimport { VariableSelector } from \"./components/VariableSelector\";\nimport { AggregationSettings } from './components/AggregationSettings';\n\ntype Props = QueryEditorProps<DataSource, MyQuery, MyDataSourceOptions>;\n\nexport const QueryEditor = ({ onChange, query, onRunQuery, datasource }: Props) => {\n    const [installations, setInstallations] = useState<Installation[]>([])\n    const [loadingInstallations, setLoadingInstallations] = useState<boolean>(true)\n\n    const squery = useMemo(() => {\n        let q = query;\n        if (q.installationId === undefined) {\n            q = { ...q, ...defaultQuery };\n            onChange(q);\n        }\n        return q;\n    }, [query, onChange])\n\n    const [functions, setFunctions] = useState<FunctionX[]>([])\n    const [loadingFunctions, setLoadingFunctions] = useState<boolean>(false)\n\n    const [selectedInstallation, setSelectedInstallation] = useState<Installation>({ id: 0, name: '', client_id: 0 })\n\n    const onRunQueryTimed = useBackoffCallback(onRunQuery, 250);\n\n    useEffect(() => {\n        datasource.fetchInstallations().then(installations => {\n            let tmpInstallation: Installation | undefined = installations.find(i => i.id === query.installationId);\n            if (tmpInstallation === undefined && installations.length === 0) {\n                tmpInstallation = { id: 0, name: 'No installations available', client_id: 0 };\n            }\n            if (tmpInstallation === undefined && installations.length > 0) {\n                tmpInstallation = installations[0];\n            }\n            setSelectedInstallation(tmpInstallation!);\n            setInstallations(installations);\n        }).finally(() => {\n            setLoadingInstallations(false)\n        });\n    }, []); // eslint-disable-line\n\n    useEffect(() => {\n        if (selectedInstallation.id === 0) {\n            return\n        }\n        setLoadingFunctions(true);\n        datasource.fetchFunctions(Number(selectedInstallation.id)).then(functions => {\n            setFunctions(functions);\n            onRunQueryTimed();\n        }).finally(() => {\n            setLoadingFunctions(false)\n        });\n    }, [setLoadingFunctions, selectedInstallation, setFunctions, datasource, onRunQueryTimed]);\n\n    const onUpdateMeta = useCallback((entries: MetaEntry[]) => {\n        onChange({ ...squery, meta: entries });\n        onRunQueryTimed();\n    }, [onChange, squery, onRunQueryTimed]);\n\n    useEffect(() => {\n        if (selectedInstallation.id !== 0 &&\n            selectedInstallation.id !== squery.installationId) {\n            onChange({ ...squery, installationId: selectedInstallation.id });\n        }\n    }, [selectedInstallation, squery, onChange])\n\n    const hints = useMemo(() => {\n        const res: { [key: string]: string[] } = {};\n        for (const func of functions) {\n            if (res[\"type\"] === undefined) {\n                res[\"type\"] = [func.type];\n            } else {\n                if (res[\"type\"].indexOf(func.type) === -1) {\n                    res[\"type\"].push(func.type);\n                }\n            }\n            for (const metaKey in func.meta) {\n                if (res[metaKey] === undefined) {\n                    res[metaKey] = [];\n                }\n                if (res[metaKey].indexOf(func.meta[metaKey]) === -1) {\n                    res[metaKey].push(func.meta[metaKey]);\n                }\n            }\n        }\n        return res;\n    }, [functions]);\n\n    const setInstallationVariable = (variable?: string) => {\n        onChange({ ...squery, installationVariable: variable });\n    };\n\n    return (\n        <div className={'section gf-form-group'}>\n            <InlineFieldRow>\n                {squery.installationVariable === undefined ?\n                    <InstallationSelector isLoading={loadingInstallations || loadingFunctions}\n                        installations={installations}\n                        installation={selectedInstallation}\n                        onSelection={setSelectedInstallation} /> :\n                    <VariableSelector value={squery.installationVariable} onSelection={setInstallationVariable} />}\n\n                <LabeledSwitch label={\"From variable\"} name={\"useVariable\"}\n                    value={squery.installationVariable !== undefined} onChange={(e) => {\n                        if (e.currentTarget.checked) {\n                            setInstallationVariable('');\n                        } else {\n                            setInstallationVariable(undefined);\n                        }\n                    }} />\n            </InlineFieldRow>\n            <AggregationSettings\n                query={query}\n                onChange={onChange}\n                onRunQuery={onRunQuery}\n            />\n            <MetaEditor entries={squery.meta || []}\n                onUpdate={onUpdateMeta}\n                hints={hints}\n            />\n            <TweakSettings query={query} onChange={onChange} onRunQuery={onRunQueryTimed} />\n        </div>\n    )\n};\n","import {useCallback, useRef} from \"react\";\nexport const useBackoffCallback = (fn: () => void, delay: number) => {\n    const ticker = useRef<number>();\n    return useCallback(() => {\n        if (ticker.current !== undefined) {\n            window.clearTimeout(ticker.current);\n        }\n        ticker.current = window.setTimeout(fn, delay);\n    }, [fn, delay]);\n}\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__781__","__WEBPACK_EXTERNAL_MODULE__531__","__WEBPACK_EXTERNAL_MODULE__7__","__WEBPACK_EXTERNAL_MODULE__241__","__WEBPACK_EXTERNAL_MODULE__308__","__WEBPACK_EXTERNAL_MODULE__959__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","p","slice","lastIndexOf","DataSource","DataSourceWithBackend","fetchInstallations","getBackendSrv","datasourceRequest","method","url","this","settings","then","result","data","fetchFunctions","installationId","meta","q","keys","map","encodeURIComponent","join","fetchDevices","query","options","templateSrv","getTemplateSrv","targets","installationVariable","toNumber","replace","super","joinMeta","deviceMeta","functionMeta","res","forEach","findMetaQuery","metaKey","Promise","resolve","id","includes","tmp","isNaN","reject","filter","reduce","acc","addDeviceMeta","devices","deviceMap","device","functions","func","dev","find","f","text","metaNameKey","name","type","metricFindQuery","queryMode","installations","installation","constructor","instanceSettings","FormField","tooltip","label","placeholder","onChange","labelWidth","width","InlineField","grow","Input","LabeledSwitch","InlineFieldRow","InlineSwitch","defaultQuery","InstallationSelector","isLoading","onSelection","installationOptions","useMemo","currentSelectedInstallation","useCallback","option","rawInput","input","toLowerCase","div","className","Select","noOptionsMessage","filterOption","menuPlacement","event","FilterEntry","values","onUpdate","onDelete","selectableKeys","selectableValues","currentKey","currentValue","onChangeKey","onChangeValue","onCreateKey","newValue","onCreateValue","deleteEventHandler","preventDefault","span","onCreateOption","isSearchable","allowCustomValue","Button","variant","onClick","icon","MetaEditor","entries","ents","hints","onMetaDelete","idx","index","onMetaAdd","e","onMetaUpdate","entry","VerticalGroup","style","paddingBottom","tooltipGroupBy","code","tooltipNameBy","br","tooltipMessageFrom","TweakSettings","onRunQuery","onSwitchChange","currentTarget","checked","spacing","groupBy","nameBy","HorizontalGroup","align","tabledata","messageFrom","linkKey","metaAsFields","joinDeviceMeta","stateOnly","metaAsLabels","VariableSelector","getVariables","variable","aggregationMethods","tooltipAggrInterval","AggregationSettings","marginBottom","aggrMethod","x","aggrInterval","isClearable","plugin","DataSourcePlugin","setConfigEditor","onOptionsChange","jsonData","secureJsonData","secureJsonFields","migrated","setMigrated","React","useEffect","apiKey","newJsonData","target","oauthPassThru","Alert","title","severity","setQueryEditor","datasource","setInstallations","useState","loadingInstallations","setLoadingInstallations","squery","setFunctions","loadingFunctions","setLoadingFunctions","selectedInstallation","setSelectedInstallation","client_id","onRunQueryTimed","fn","delay","ticker","useRef","current","window","clearTimeout","setTimeout","useBackoffCallback","tmpInstallation","i","length","finally","Number","onUpdateMeta","indexOf","push","setInstallationVariable","setVariableQueryEditor","onChangeText","RadioButtonGroup","v","toString"],"sourceRoot":""}